<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="guildai">
<title>Introduction • guildai</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
<meta property="og:description" content="guildai">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">guildai</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/intro.html">Introduction</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction</h1>
            
      
      
      <div class="d-none name"><code>intro.Rmd</code></div>
    </div>

    
    
<!-- a nice screenshot image here-->
<p><em>guildai</em> provides a suite of tools for tracking, visualizing,
and managing training runs and experiments. The {guildai} R package is a
successor to the {tfruns} package.</p>
<ul>
<li><p>Track the hyperparameters, metrics, output, and source code of
every training run.</p></li>
<li><p>Compare hyperparmaeters and metrics across runs to find the best
performing model.</p></li>
<li><p>Automatically generate reports to visualize individual training
runs or comparisons between runs.</p></li>
<li><p>No changes to source code required.</p></li>
</ul>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The R package provides an interface to <a href="https://guild.ai/" class="external-link">guildai core</a>. The R package will
auomatically guildai core on first use, or you can call
<code><a href="../reference/install_guild.html">install_guild()</a></code> directly to customize the installation. You
can install the <strong>guildai</strong> package from CRAN as
follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"guildai"</span><span class="op">)</span></span>
<span><span class="fu">guildai</span><span class="fu">::</span><span class="fu"><a href="../reference/install_guild.html">install_guild</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>{guildai} can be used with any machine learning framework, or even no
framework at all. For this introductory example, we’ll start with a
Keras model applied to the fashion mnist dataset.</p>
<p>If you’ve not used Keras from R before and you want to follow along
on your machine, you can install it like this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"keras"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keras.rstudio.com" class="external-link">keras</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/install_keras.html" class="external-link">install_keras</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="hello-world">Hello World<a class="anchor" aria-label="anchor" href="#hello-world"></a>
</h2>
<div class="section level3">
<h3 id="launch-a-run">Launch a run<a class="anchor" aria-label="anchor" href="#launch-a-run"></a>
</h3>
<p>To start, we’ll setup a sample project folder with one script.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/fashion-mnist.R"</span>, package <span class="op">=</span> <span class="st">"guildai"</span><span class="op">)</span>,</span>
<span>          <span class="st">"."</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Here is what the training script looks like:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keras.rstudio.com" class="external-link">keras</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare data ----</span></span>
<span><span class="va">fashion_mnist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/dataset_fashion_mnist.html" class="external-link">dataset_fashion_mnist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">train_images</span>, <span class="va">train_labels</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/zeallot/man/operator.html" class="external-link">%&lt;-%</a></span> <span class="va">fashion_mnist</span><span class="op">$</span><span class="va">train</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">test_images</span>, <span class="va">test_labels</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/zeallot/man/operator.html" class="external-link">%&lt;-%</a></span> <span class="va">fashion_mnist</span><span class="op">$</span><span class="va">test</span></span>
<span></span>
<span><span class="va">train_images</span> <span class="op">&lt;-</span> <span class="va">train_images</span> <span class="op">/</span> <span class="fl">255</span></span>
<span> <span class="va">test_images</span> <span class="op">&lt;-</span> <span class="va">test_images</span> <span class="op">/</span> <span class="fl">255</span></span>
<span></span>
<span><span class="co"># Define model ----</span></span>
<span></span>
<span><span class="va">units</span> <span class="op">&lt;-</span> <span class="fl">64</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/keras_model_sequential.html" class="external-link">keras_model_sequential</a></span><span class="op">(</span>input_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">28</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_flatten.html" class="external-link">layer_flatten</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="va">units</span>, activation <span class="op">=</span> <span class="st">'relu'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">10</span>, activation <span class="op">=</span> <span class="st">'softmax'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">learning_rate</span> <span class="op">&lt;-</span> <span class="fl">0.001</span></span>
<span></span>
<span><span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://generics.r-lib.org/reference/compile.html" class="external-link">compile</a></span><span class="op">(</span></span>
<span>  optimizer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/optimizer_adam.html" class="external-link">optimizer_adam</a></span><span class="op">(</span><span class="va">learning_rate</span><span class="op">)</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">'sparse_categorical_crossentropy'</span>,</span>
<span>  metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'accuracy'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span></span>
<span></span>
<span><span class="co"># Fit model ----</span></span>
<span></span>
<span><span class="va">batch_size</span> <span class="op">&lt;-</span> <span class="fl">32</span></span>
<span><span class="va">epochs</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span></span>
<span><span class="va">.fast</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">.fast</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span></span>
<span>  <span class="va">train_images</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="op">{</span> <span class="va">.</span><span class="op">[</span><span class="va">n</span>, ,<span class="op">]</span> <span class="op">}</span></span>
<span>  <span class="va">test_images</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="op">{</span> <span class="va">.</span><span class="op">[</span><span class="va">n</span>, ,<span class="op">]</span> <span class="op">}</span></span>
<span>  <span class="va">test_labels</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="op">{</span> <span class="va">.</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">}</span></span>
<span>  <span class="va">train_labels</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="op">{</span> <span class="va">.</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">}</span></span>
<span>  <span class="va">epochs</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">history</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">train_images</span>, <span class="va">train_labels</span>,</span>
<span>      validation_split <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>      batch_size <span class="op">=</span> <span class="va">batch_size</span>,</span>
<span>      epochs <span class="op">=</span> <span class="va">epochs</span>,</span>
<span>      verbose <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">history</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate model ----</span></span>
<span></span>
<span><span class="va">score</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tensorflow/man/evaluate.html" class="external-link">evaluate</a></span><span class="op">(</span><span class="va">test_images</span>, <span class="va">test_labels</span>,</span>
<span>           verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'test_loss:'</span>, <span class="va">score</span><span class="op">$</span><span class="va">loss</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'test_accuracy:'</span>, <span class="va">score</span><span class="op">$</span><span class="va">accuracy</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save_model_tf(model, "model.keras")</span></span>
<span><span class="co"># saveRDS(history, "history.rds")</span></span></code></pre></div>
<p>To train a model with <strong>guildai</strong>, use the
<code><a href="../reference/guild_run.html">guild_run()</a></code> function in place of the <code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code>
function to execute your R script. For example:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"fashion-mnist.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Replaced expression '.fast &lt;- TRUE' on line 38 with '.fast &lt;- FALSE'</span></span>
<span><span class="co">#&gt; &gt; library(keras)</span></span>
<span><span class="co">#&gt; &gt; # Prepare data ----</span></span>
<span><span class="co">#&gt; &gt; fashion_mnist &lt;- dataset_fashion_mnist()</span></span>
<span><span class="co">#&gt; 2022-11-02 17:07:32.971807: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered</span></span>
<span><span class="co">#&gt; &gt; c(train_images, train_labels) %&lt;-% fashion_mnist$train</span></span>
<span><span class="co">#&gt; &gt; c(test_images, test_labels) %&lt;-% fashion_mnist$test</span></span>
<span><span class="co">#&gt; &gt; train_images &lt;- train_images / 255</span></span>
<span><span class="co">#&gt; &gt;  test_images &lt;- test_images / 255</span></span>
<span><span class="co">#&gt; &gt; # Define model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; units &lt;- 64</span></span>
<span><span class="co">#&gt; &gt; model &lt;- keras_model_sequential(input_shape = c(28, 28))</span></span>
<span><span class="co">#&gt; &gt; model %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_flatten() %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_dense(units = units, activation = 'relu') %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_dense(units = 10, activation = 'softmax')</span></span>
<span><span class="co">#&gt; &gt; learning_rate &lt;- 0.001</span></span>
<span><span class="co">#&gt; &gt; model %&gt;% compile(</span></span>
<span><span class="co">#&gt; +   optimizer = optimizer_adam(learning_rate),</span></span>
<span><span class="co">#&gt; +   loss = 'sparse_categorical_crossentropy',</span></span>
<span><span class="co">#&gt; +   metrics = c('accuracy')</span></span>
<span><span class="co">#&gt; + )</span></span>
<span><span class="co">#&gt; &gt; model</span></span>
<span><span class="co">#&gt; Model: "sequential"</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt;  Layer (type)                       Output Shape                    Param #     </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt;  flatten (Flatten)                  (None, 784)                     0           </span></span>
<span><span class="co">#&gt;  dense_1 (Dense)                    (None, 64)                      50240       </span></span>
<span><span class="co">#&gt;  dense (Dense)                      (None, 10)                      650         </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; Total params: 50,890</span></span>
<span><span class="co">#&gt; Trainable params: 50,890</span></span>
<span><span class="co">#&gt; Non-trainable params: 0</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt; &gt; # Fit model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; batch_size &lt;- 32</span></span>
<span><span class="co">#&gt; &gt; epochs &lt;- 20</span></span>
<span><span class="co">#&gt; &gt; .fast &lt;- FALSE</span></span>
<span><span class="co">#&gt; &gt; if (.fast) {</span></span>
<span><span class="co">#&gt; +   n &lt;- 1:20</span></span>
<span><span class="co">#&gt; +   train_images %&lt;&gt;% { .[n, ,] }</span></span>
<span><span class="co">#&gt; +   test_images %&lt;&gt;% { .[n, ,] }</span></span>
<span><span class="co">#&gt; +   test_labels %&lt;&gt;% { .[n] }</span></span>
<span><span class="co">#&gt; +   train_labels %&lt;&gt;% { .[n] }</span></span>
<span><span class="co">#&gt; +   epochs &lt;- 2</span></span>
<span><span class="co">#&gt; + }</span></span>
<span><span class="co">#&gt; &gt; history &lt;- model %&gt;%</span></span>
<span><span class="co">#&gt; +   fit(train_images, train_labels,</span></span>
<span><span class="co">#&gt; +       validation_split = 0.2,</span></span>
<span><span class="co">#&gt; +       batch_size = batch_size,</span></span>
<span><span class="co">#&gt; +       epochs = epochs,</span></span>
<span><span class="co">#&gt; +       verbose = 2)</span></span>
<span><span class="co">#&gt; Epoch 1/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 5s - loss: 0.5445 - accuracy: 0.8128 - val_loss: 0.4428 - val_accuracy: 0.8468 - 5s/epoch - 3ms/step</span></span>
<span><span class="co">#&gt; Epoch 2/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 3s - loss: 0.4088 - accuracy: 0.8546 - val_loss: 0.4032 - val_accuracy: 0.8556 - 3s/epoch - 2ms/step</span></span>
<span><span class="co">#&gt; Epoch 3/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 3s - loss: 0.3654 - accuracy: 0.8698 - val_loss: 0.3712 - val_accuracy: 0.8701 - 3s/epoch - 2ms/step</span></span>
<span><span class="co">#&gt; Epoch 4/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 3s - loss: 0.3381 - accuracy: 0.8779 - val_loss: 0.3731 - val_accuracy: 0.8652 - 3s/epoch - 2ms/step</span></span>
<span><span class="co">#&gt; Epoch 5/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 3s - loss: 0.3189 - accuracy: 0.8821 - val_loss: 0.3356 - val_accuracy: 0.8793 - 3s/epoch - 2ms/step</span></span>
<span><span class="co">#&gt; Epoch 6/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 2s - loss: 0.3000 - accuracy: 0.8896 - val_loss: 0.3324 - val_accuracy: 0.8823 - 2s/epoch - 2ms/step</span></span>
<span><span class="co">#&gt; Epoch 7/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 3s - loss: 0.2881 - accuracy: 0.8944 - val_loss: 0.3259 - val_accuracy: 0.8843 - 3s/epoch - 2ms/step</span></span>
<span><span class="co">#&gt; Epoch 8/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 2s - loss: 0.2754 - accuracy: 0.8981 - val_loss: 0.3359 - val_accuracy: 0.8799 - 2s/epoch - 2ms/step</span></span>
<span><span class="co">#&gt; Epoch 9/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 2s - loss: 0.2691 - accuracy: 0.9009 - val_loss: 0.3361 - val_accuracy: 0.8839 - 2s/epoch - 2ms/step</span></span>
<span><span class="co">#&gt; Epoch 10/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 2s - loss: 0.2571 - accuracy: 0.9047 - val_loss: 0.3448 - val_accuracy: 0.8767 - 2s/epoch - 2ms/step</span></span>
<span><span class="co">#&gt; Epoch 11/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 2s - loss: 0.2501 - accuracy: 0.9074 - val_loss: 0.3249 - val_accuracy: 0.8878 - 2s/epoch - 2ms/step</span></span>
<span><span class="co">#&gt; Epoch 12/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 3s - loss: 0.2430 - accuracy: 0.9103 - val_loss: 0.3271 - val_accuracy: 0.8864 - 3s/epoch - 2ms/step</span></span>
<span><span class="co">#&gt; Epoch 13/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 5s - loss: 0.2369 - accuracy: 0.9122 - val_loss: 0.3311 - val_accuracy: 0.8869 - 5s/epoch - 3ms/step</span></span>
<span><span class="co">#&gt; Epoch 14/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 4s - loss: 0.2317 - accuracy: 0.9124 - val_loss: 0.3590 - val_accuracy: 0.8767 - 4s/epoch - 2ms/step</span></span>
<span><span class="co">#&gt; Epoch 15/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 3s - loss: 0.2275 - accuracy: 0.9146 - val_loss: 0.3206 - val_accuracy: 0.8917 - 3s/epoch - 2ms/step</span></span>
<span><span class="co">#&gt; Epoch 16/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 3s - loss: 0.2199 - accuracy: 0.9185 - val_loss: 0.3362 - val_accuracy: 0.8921 - 3s/epoch - 2ms/step</span></span>
<span><span class="co">#&gt; Epoch 17/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 3s - loss: 0.2150 - accuracy: 0.9201 - val_loss: 0.3251 - val_accuracy: 0.8894 - 3s/epoch - 2ms/step</span></span>
<span><span class="co">#&gt; Epoch 18/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 4s - loss: 0.2122 - accuracy: 0.9200 - val_loss: 0.3462 - val_accuracy: 0.8816 - 4s/epoch - 3ms/step</span></span>
<span><span class="co">#&gt; Epoch 19/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 3s - loss: 0.2067 - accuracy: 0.9225 - val_loss: 0.3325 - val_accuracy: 0.8905 - 3s/epoch - 2ms/step</span></span>
<span><span class="co">#&gt; Epoch 20/20</span></span>
<span><span class="co">#&gt; 1500/1500 - 4s - loss: 0.2019 - accuracy: 0.9246 - val_loss: 0.3300 - val_accuracy: 0.8906 - 4s/epoch - 3ms/step</span></span>
<span><span class="co">#&gt; &gt; plot(history)</span></span>
<span><span class="co">#&gt; &gt; # Evaluate model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; score &lt;- model %&gt;%</span></span>
<span><span class="co">#&gt; +   evaluate(test_images, test_labels,</span></span>
<span><span class="co">#&gt; +            verbose = 0) %&gt;%</span></span>
<span><span class="co">#&gt; +   as.list()</span></span>
<span><span class="co">#&gt; &gt; cat('test_loss:', score$loss, "\n")</span></span>
<span><span class="co">#&gt; test_loss: 0.36920532584190369 </span></span>
<span><span class="co">#&gt; &gt; cat('test_accuracy:', score$accuracy, "\n")</span></span>
<span><span class="co">#&gt; test_accuracy: 0.88209998607635498 </span></span>
<span><span class="co">#&gt; &gt; # save_model_tf(model, "model.keras")</span></span>
<span><span class="co">#&gt; &gt; # saveRDS(history, "history.rds")</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt;</span></span></code></pre></div>
<p>This will launch a new process in an isolated run directory using the
provided script. By default, the output stream from the run will be
shown at the R console (the same output stream you would see with
<code>source("fashion-mnist.R", echo = TRUE)</code> or
<code>Rscript fashion-mnist.R</code>).</p>
</div>
<div class="section level3">
<h3 id="view-runs">View Runs<a class="anchor" aria-label="anchor" href="#view-runs"></a>
</h3>
<p>You can view your runs (including while they are running) with the
“Guild View” application, by calling <code><a href="../reference/guild_view.html">guild_view()</a></code>. The
Guild View</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/guild_view.html">guild_view</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>TODO: SCREENSHOT</p>
<p>You can retrieve a data frame with run information using
<code><a href="../reference/ls_runs.html">ls_runs()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ls_runs.html">ls_runs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">run</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 1</span></span>
<span><span class="co">#&gt; Columns: 16</span></span>
<span><span class="co">#&gt; $ label      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> ".fast=no batch_size=32.0 epochs=20.0 learning_rate=0.001 u…</span></span>
<span><span class="co">#&gt; $ tags       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> ""</span></span>
<span><span class="co">#&gt; $ marked     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE</span></span>
<span><span class="co">#&gt; $ scalars    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> [&lt;tbl_df[2 x 14]&gt;]</span></span>
<span><span class="co">#&gt; $ flags      <span style="color: #949494; font-style: italic;">&lt;tibble[,5]&gt;</span> &lt;tbl_df[1 x 5]&gt;</span></span>
<span><span class="co">#&gt; $ operation  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "fashion-mnist.R"</span></span>
<span><span class="co">#&gt; $ started    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span> 2022-11-02 17:07:30</span></span>
<span><span class="co">#&gt; $ stopped    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span> 2022-11-02 17:08:43</span></span>
<span><span class="co">#&gt; $ comments   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> [&lt;tbl_df[0 x 4]&gt;]</span></span>
<span><span class="co">#&gt; $ status     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "completed"</span></span>
<span><span class="co">#&gt; $ exitStatus <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0</span></span>
<span><span class="co">#&gt; $ otherAttrs <span style="color: #949494; font-style: italic;">&lt;df[,1]&gt;</span> &lt;data.frame[1 x 1]&gt;</span></span>
<span><span class="co">#&gt; $ deps       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> []</span></span>
<span><span class="co">#&gt; $ projectDir <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "/home/tomasz/guild/guildai-r/vignettes/articles"</span></span>
<span><span class="co">#&gt; $ dir        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "/home/tomasz/guild/guildai-r/vignettes/articles/.guild/ru…</span></span>
<span><span class="co">#&gt; $ id         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "e10aaf975fb04f9c9440c8db3f019997"</span></span></code></pre></div>
<p><code><a href="../reference/ls_runs.html">ls_runs()</a></code> returns a data frame with information about
runs. In our sample project, we’ve launched one run, so
<code><a href="../reference/ls_runs.html">ls_runs()</a></code> returns a 1-row data frame.</p>
</div>
<div class="section level3">
<h3 id="run-directories">Run Directories<a class="anchor" aria-label="anchor" href="#run-directories"></a>
</h3>
<p><code><a href="../reference/guild_view.html">guild_view()</a></code> and <code><a href="../reference/ls_runs.html">ls_runs()</a></code> provide two
convenient ways to gather and present the information from runs.
Importantly however, the run directory is easily accessible, where
everything about the run is available as plain text files. The run
directory also contain any artifacts generated by the run process, like
model check points.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="va">run</span><span class="op">$</span><span class="va">dir</span>, all<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">/home/tomasz/guild/guildai-r/vignettes/articles/.guild/runs/e10aaf975fb04f9c9440c8db3f019997</span></span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">.guild</span></span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">attrs</span></span></span>
<span><span class="co">#&gt; │   │   ├── cmd</span></span>
<span><span class="co">#&gt; │   │   ├── deps</span></span>
<span><span class="co">#&gt; │   │   ├── env</span></span>
<span><span class="co">#&gt; │   │   ├── exit_status</span></span>
<span><span class="co">#&gt; │   │   ├── flags</span></span>
<span><span class="co">#&gt; │   │   ├── host</span></span>
<span><span class="co">#&gt; │   │   ├── id</span></span>
<span><span class="co">#&gt; │   │   ├── initialized</span></span>
<span><span class="co">#&gt; │   │   ├── label</span></span>
<span><span class="co">#&gt; │   │   ├── op</span></span>
<span><span class="co">#&gt; │   │   ├── platform</span></span>
<span><span class="co">#&gt; │   │   ├── r-random-seed</span></span>
<span><span class="co">#&gt; │   │   ├── run_params</span></span>
<span><span class="co">#&gt; │   │   ├── sourcecode_digest</span></span>
<span><span class="co">#&gt; │   │   ├── started</span></span>
<span><span class="co">#&gt; │   │   ├── stopped</span></span>
<span><span class="co">#&gt; │   │   ├── user</span></span>
<span><span class="co">#&gt; │   │   ├── user_flags</span></span>
<span><span class="co">#&gt; │   │   └── vcs_commit</span></span>
<span><span class="co">#&gt; │   ├── events.out.tfevents.1667423323.horse.180500.0</span></span>
<span><span class="co">#&gt; │   ├── manifest</span></span>
<span><span class="co">#&gt; │   ├── opref</span></span>
<span><span class="co">#&gt; │   ├── output</span></span>
<span><span class="co">#&gt; │   ├── output.index</span></span>
<span><span class="co">#&gt; │   └── <span style="color: #0000BB; font-weight: bold;">sourcecode</span></span></span>
<span><span class="co">#&gt; │       └── <span style="color: #00BB00;">fashion-mnist.R</span></span></span>
<span><span class="co">#&gt; └── <span style="color: #0000BB; font-weight: bold;">plots</span></span></span>
<span><span class="co">#&gt;     └── <span style="color: #BB00BB; font-weight: bold;">Rplot001.png</span></span></span></code></pre></div>
<p>A run can also be used to generate a summary report, a paramaterized
quarto document:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/view_run_report.html">view_run_report</a></span><span class="op">(</span><span class="va">run</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comparing-runs">Comparing Runs<a class="anchor" aria-label="anchor" href="#comparing-runs"></a>
</h3>
<p>Let’s make a couple of changes to our training script to see if we
can improve model performance. We’ll change the number of units in our
first dense layer to 128, change the <code>learning_rate</code> from
0.001 to 0.003 and run 30 rather than 20 <code>epochs</code>. After
making these changes to the source code we re-run the script using
<code><a href="../reference/guild_run.html">guild_run()</a></code> as before:</p>
<pre><code><span><span class="co">#&gt; Replaced expression 'units &lt;- 64' on line 14 with 'units &lt;- 128'</span></span>
<span><span class="co">#&gt; Replaced expression 'learning_rate &lt;- 0.001' on line 23 with 'learning_rate &lt;- 0.003'</span></span>
<span><span class="co">#&gt; Replaced expression 'epochs &lt;- 20' on line 36 with 'epochs &lt;- 30'</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"fashion-mnist.R"</span><span class="op">)</span></span></code></pre></div>
<p>This will also show us a report summarizing the results of the run,
but what we are really interested in is a comparison between this run
and the previous one.</p>
<p>The individual metrics <code>test_loss</code> and
<code>test_accuracy</code> are visible in the comparison table in the
Guild View application, as well as in the We can view a comparison via
the <code><a href="../reference/view_runs_diff.html">view_runs_diff()</a></code> function:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/view_runs_diff.html">view_runs_diff</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The comparison report shows the model attributes and metrics
side-by-side, as well as differences in the source code and output of
the training script.</p>
<p>Note that <code><a href="../reference/view_runs_diff.html">view_runs_diff()</a></code> will by default compare the
last two runs, however you can pass any two run ids you like to be
compared.</p>
<pre><code><span><span class="co">#&gt; [1] TRUE</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="flags">Flags<a class="anchor" aria-label="anchor" href="#flags"></a>
</h2>
<p>Flags are a form of run inputs, or paramaterization. The action we
just described, of modifying <code>learning_rate</code>,
<code>epochs</code> and <code>units</code> values in the script before
launching the second run, can be performed by <code><a href="../reference/guild_run.html">guild_run()</a></code>
using the <em>flags</em> interface.</p>
<p>By default, guild identifies all top-level assignments of scalar
literals in an R script as <em>run flags</em> that can be modified
per-run. You can quickly see what flags are available in an R script by
passing <code>--help-op</code> (more on this later).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"fashion-mnist.R"</span>, <span class="st">"--help-op"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Usage: guild run [OPTIONS] fashion-mnist.R [FLAG]...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Use 'guild run --help' for a list of options.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Flags:</span></span>
<span><span class="co">#&gt;   .fast          (default is yes)</span></span>
<span><span class="co">#&gt;   batch_size     (default is 32.0)</span></span>
<span><span class="co">#&gt;   epochs         (default is 20.0)</span></span>
<span><span class="co">#&gt;   learning_rate  (default is 0.001)</span></span>
<span><span class="co">#&gt;   units          (default is 64.0)</span></span></code></pre></div>
<p>You can launch a run with different flag values like this:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="fu"><a href="../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"fashion-mnist.R"</span>, </span>
<span>              flags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>learning_rate <span class="op">=</span> <span class="fl">0.001</span>, </span>
<span>                           units <span class="op">=</span> <span class="fl">256</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now, when we inspect the run sources with
<code><a href="../reference/view_runs_diff.html">view_runs_diff()</a></code>, we see that the source file from the last
run has updated flag values, as if we had modified them manually.</p>
<p>The flags interface is useful for hyperparamater optimization. At
it’s simplest, you can use just iterate over the set of flag values you
want and pass them to <code><a href="../reference/guild_run.html">guild_run()</a></code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">learning_rate</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.0003</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"fashion-mnist.R"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>learning_rate <span class="op">=</span> <span class="va">learning_rate</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>You can also pass multiple values for each flag, and guild will
automatically expand the combinations to a grid search. For example,
this will launch 4 training runs, with each combination of flag
values:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"fashion-mnist.R"</span>, </span>
<span>          flags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>learning_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.003</span><span class="op">)</span>,</span>
<span>                       units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">128</span>, <span class="fl">256</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Another way to launch a batch of runs is to pass a dataframe of flags
values, with each row corresponding to a run.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flags_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>learning_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.003</span><span class="op">)</span>,</span>
<span>                        units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">128</span>, <span class="fl">256</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">flags_df</span></span>
<span><span class="co">#&gt;   learning_rate units</span></span>
<span><span class="co">#&gt; 1         0.001   128</span></span>
<span><span class="co">#&gt; 2         0.003   128</span></span>
<span><span class="co">#&gt; 3         0.001   256</span></span>
<span><span class="co">#&gt; 4         0.003   256</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"fashion-mnist.R"</span>, flags <span class="op">=</span> <span class="va">flags_df</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="flag-annotations">Flag annotations<a class="anchor" aria-label="anchor" href="#flag-annotations"></a>
</h3>
<p>You can optionally supply additional metadata about individual flags
by placing hashpipe yaml annotations above the flag expression. For
example, we can update our “fashion-mnist.R” script with the following
lines:</p>
<pre><code><span><span class="co">#| description: size of first layer.</span></span>
<span><span class="co">#| min: 16</span></span>
<span><span class="co">#| max: 256</span></span>
<span><span class="va">units</span> <span class="op">&lt;-</span> <span class="fl">32</span></span>
<span></span>
<span><span class="co">#| description: Activation function to use.</span></span>
<span><span class="co">#| choices: [relu, sigmoid, tanh]</span></span>
<span><span class="va">activation</span> <span class="op">&lt;-</span> <span class="st">"relu"</span></span></code></pre>
<p>Now, the <code>description</code>s and constraints will appear in
<code>--help-op</code> and related locations.</p>
</div>
<div class="section level3">
<h3 id="flag-destinations">Flag destinations<a class="anchor" aria-label="anchor" href="#flag-destinations"></a>
</h3>
<p>As a project grows, it’s helpful to be able to move flag definitions
out of the main R script. To do so, you can include a
<code>flags-dest</code> in the frontmatter of the R script, specifying
the file where guild should update the flag values. Then you can read in
the flags using <code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code> or similar.</p>
<pre><code><span><span class="co">#| flags-dest: ./flags.R</span></span>
<span></span>
<span><span class="va">FLAGS</span> <span class="op">&lt;-</span> <span class="fu">envir</span><span class="fu">::</span><span class="fu"><a href="https://t-kalinowski.github.io/envir/reference/include.html" class="external-link">include</a></span><span class="op">(</span><span class="st">"flags.R"</span>, <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>YAML files are also supported as a flags destination:</p>
<pre><code><span><span class="co">#| flags-dest: ./flags.yml</span></span>
<span></span>
<span><span class="va">FLAGS</span> <span class="op">&lt;-</span> <span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html" class="external-link">read_yaml</a></span><span class="op">(</span><span class="st">"flags.yml"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="retreiving-run-flags">Retreiving Run Flags<a class="anchor" aria-label="anchor" href="#retreiving-run-flags"></a>
</h3>
<p>The flags and flag values associated with each runs are returned by
<code><a href="../reference/ls_runs.html">ls_runs()</a></code> as a nested dataframe under
<code>flags</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">runs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ls_runs.html">ls_runs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">runs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">id</span>, <span class="va">flags</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   id                               flags$.fast $batch_s…¹ $epochs $lear…² $units</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> b7f82479b63c469e95bd71e7ab05aa18 FALSE               32      30   0.003    128</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> e10aaf975fb04f9c9440c8db3f019997 FALSE               32      20   0.001     64</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with abbreviated variable names ¹​$batch_size, ²​$learning_rate</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="scalars">Scalars<a class="anchor" aria-label="anchor" href="#scalars"></a>
</h2>
<p>The counterpart to run <code>flags</code> are run
<code>scalars</code>. Whereas <code>flags</code> are a a special type of
run input that guild can help manage, scalars are special type of run
output that guild can help manage.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">runs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">id</span>, <span class="va">scalars</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   id                               scalars          </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> b7f82479b63c469e95bd71e7ab05aa18 <span style="color: #949494;">&lt;tibble [2 × 14]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> e10aaf975fb04f9c9440c8db3f019997 <span style="color: #949494;">&lt;tibble [2 × 14]&gt;</span></span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">runs</span><span class="op">$</span><span class="va">scalars</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 2</span></span>
<span><span class="co">#&gt; Columns: 14</span></span>
<span><span class="co">#&gt; $ run        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "b7f82479b63c469e95bd71e7ab05aa18", "b7f82479b63c469e95bd71…</span></span>
<span><span class="co">#&gt; $ prefix     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> ".guild", ".guild"</span></span>
<span><span class="co">#&gt; $ tag        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "test_accuracy", "test_loss"</span></span>
<span><span class="co">#&gt; $ first_val  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.8676000, 0.4961661</span></span>
<span><span class="co">#&gt; $ first_step <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0</span></span>
<span><span class="co">#&gt; $ last_val   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.8676000, 0.4961661</span></span>
<span><span class="co">#&gt; $ last_step  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0</span></span>
<span><span class="co">#&gt; $ min_val    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.8676000, 0.4961661</span></span>
<span><span class="co">#&gt; $ min_step   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0</span></span>
<span><span class="co">#&gt; $ max_val    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.8676000, 0.4961661</span></span>
<span><span class="co">#&gt; $ max_step   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0</span></span>
<span><span class="co">#&gt; $ avg_val    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.8676000, 0.4961661</span></span>
<span><span class="co">#&gt; $ total      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.8676000, 0.4961661</span></span>
<span><span class="co">#&gt; $ count      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1</span></span></code></pre></div>
<p>Here we see that guild has automatically identified
<code>test_accuracy</code> and <code>test_loss</code> as run scalar
outputs. By default, any lines printed to standard output during the run
with the pattern <code>"key: &lt;numeric-value&gt;"</code> are recorded
by guild as <code>scalars</code>. If you are printing values for the
same scalar <code>key</code> multiple times during a run (e.g,
<code>loss</code> during a training loop), then be sure to also print a
<code>step</code> scalar in between, to enable guild to track history
(and enable visualization of the run metrics with tensorboard).</p>
<p>If your run process produces tfevent records directly (e.g.,
<code>keras::callback_tensorboard("./logs")</code>), then those are also
automatically identified by guild a run scalars, and included in
<code><a href="../reference/ls_runs.html">ls_runs()</a></code> (and <code><a href="../reference/guild_view.html">guild_view()</a></code>, and tensorboard
and other run views).</p>
<p><code><a href="../reference/ls_runs.html">ls_runs()</a></code> returns a summary of run scalars, but the full
set of scalars observed in runs can also be accessed from R
directly:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ls_scalars.html">ls_scalars</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">#&gt;   run                              path   tag           value  step</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> b7f82479b63c469e95bd71e7ab05aa18 .guild test_loss     0.496     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> b7f82479b63c469e95bd71e7ab05aa18 .guild test_accuracy 0.868     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> e10aaf975fb04f9c9440c8db3f019997 .guild test_loss     0.369     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> e10aaf975fb04f9c9440c8db3f019997 .guild test_accuracy 0.882     0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="managing-runs">Managing runs<a class="anchor" aria-label="anchor" href="#managing-runs"></a>
</h2>
<p>Guild comes with a comprehensive set of functions for managing
runs.</p>
<ul>
<li>annotate runs: <code><a href="../reference/runs_label.html">runs_comment()</a></code>, <code><a href="../reference/runs_label.html">runs_mark()</a></code>
and <code><a href="../reference/runs_label.html">runs_tag()</a></code>.</li>
<li>move, archive, or copy runs: <code><a href="../reference/runs_export.html">runs_export()</a></code> and
<code><a href="../reference/runs_export.html">runs_import()</a></code>
</li>
<li>delete runs: <code><a href="../reference/runs_delete.html">runs_delete()</a></code> <code><a href="../reference/runs_delete.html">runs_purge()</a></code>
<code><a href="../reference/runs_delete.html">runs_restore()</a></code>
</li>
</ul>
<p>The <code>runs_*</code> family of functions all take
<code>runs</code> as a first argument, and can be conveniently composed
with <code>%&gt;%</code> and <code><a href="../reference/ls_runs.html">ls_runs()</a></code> or
<code><a href="../reference/ls_scalars.html">ls_scalars()</a></code>. For example:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">top3_runs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ls_scalars.html">ls_scalars</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tag</span> <span class="op">==</span> <span class="st">"test_accuracy"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="va">value</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">top3_runs</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   run                              path   tag           value  step</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> e10aaf975fb04f9c9440c8db3f019997 .guild test_accuracy 0.882     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> b7f82479b63c469e95bd71e7ab05aa18 .guild test_accuracy 0.868     0</span></span>
<span></span>
<span><span class="va">top3_runs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/runs_label.html">runs_tag</a></span><span class="op">(</span><span class="st">"top3"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/runs_export.html">runs_export</a></span><span class="op">(</span><span class="st">"./top3-runs"</span><span class="op">)</span></span></code></pre></div>
<p><code>runs</code> can be supplied like a dataframe returned by
<code><a href="../reference/ls_runs.html">ls_runs()</a></code> or <code><a href="../reference/ls_scalars.html">ls_scalars()</a></code> like in the example
above. <code>runs</code> can also be a character vector where there is a
flexible syntax supported for specifying runs selections. See
<code>?resolve_run_ids()</code> for details.</p>
</div>
<div class="section level2">
<h2 id="using-guild-from-the-terminal">Using guild from the terminal<a class="anchor" aria-label="anchor" href="#using-guild-from-the-terminal"></a>
</h2>
<p><code>guild</code> can also be used directly from the terminal. Call
the R function <code><a href="../reference/export_guild_cli.html">export_guild_cli()</a></code> to place the
<code>guild</code> executable on your PATH:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/export_guild_cli.html">export_guild_cli</a></span><span class="op">(</span>dest <span class="op">=</span> <span class="st">"~/bin"</span><span class="op">)</span></span></code></pre></div>
<p>Then you can launch runs and perform other guild operations from the
terminal:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">guild</span> run fashion-mnist.R</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="ex">guild</span> run fashion-mnist.R batch_size=<span class="st">'[32,64]'</span></span></code></pre></div>
<p>As you move between the terminal and the R console, almost all of the
same syntax supported from the terminal can be used from R by passing
strings:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"fashion-mnist.R"</span>, <span class="st">'batch_size=[32,64]'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit_exit.html" class="external-link">knit_exit</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tomasz Kalinowski.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
