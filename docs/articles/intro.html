<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="guildai">
<title>Introduction • guildai</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
<meta property="og:description" content="guildai">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">guildai</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/intro.html">Introduction</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction</h1>
            
      
      
      <div class="d-none name"><code>intro.Rmd</code></div>
    </div>

    
    
<!-- a nice screenshot image here-->
<p><em>guildai</em> provides a suite of tools for tracking, visualizing,
and managing training runs and experiments. The {guildai} R package is a
successor to the {tfruns} package.</p>
<ul>
<li><p>Track the hyperparameters, metrics, output, and source code of
every training run.</p></li>
<li><p>Compare hyperparmaeters and metrics across runs to find the best
performing model.</p></li>
<li><p>Automatically generate reports to visualize individual training
runs or comparisons between runs.</p></li>
<li><p>No changes to source code required.</p></li>
</ul>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The R package provides an interface to (guildai core)[<a href="https://guild.ai/" class="external-link uri">https://guild.ai/</a>]. The R
package will install guildai core on first use, or you can call
<code><a href="../reference/install_guild.html">install_guild()</a></code> to customize the installation. You can
install the <strong>guildai</strong> package from CRAN as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"guildai"</span><span class="op">)</span></span>
<span><span class="fu">guildai</span><span class="fu">::</span><span class="fu"><a href="../reference/install_guild.html">install_guild</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>{guildai} can be used with any machine learning framework, or even no
framework at all. For this introductory example, we’ll start with a
Keras model applied to the fashion mnist dataset.</p>
<p>If you’ve not used Keras from R before and you want to follow along
on your machine, you can install it like this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"keras"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keras.rstudio.com" class="external-link">keras</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/install_keras.html" class="external-link">install_keras</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="training">Training<a class="anchor" aria-label="anchor" href="#training"></a>
</h2>
<p>To start, we’ll setup a sample project folder with one script.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/fashion-mnist.R"</span>, package <span class="op">=</span> <span class="st">"guildai"</span><span class="op">)</span>,</span>
<span>          <span class="st">"."</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Here is what the training script looks like:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keras.rstudio.com" class="external-link">keras</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare data ----</span></span>
<span><span class="va">fashion_mnist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/dataset_fashion_mnist.html" class="external-link">dataset_fashion_mnist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">train_images</span>, <span class="va">train_labels</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/zeallot/man/operator.html" class="external-link">%&lt;-%</a></span> <span class="va">fashion_mnist</span><span class="op">$</span><span class="va">train</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">test_images</span>, <span class="va">test_labels</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/zeallot/man/operator.html" class="external-link">%&lt;-%</a></span> <span class="va">fashion_mnist</span><span class="op">$</span><span class="va">test</span></span>
<span></span>
<span><span class="va">train_images</span> <span class="op">&lt;-</span> <span class="va">train_images</span> <span class="op">/</span> <span class="fl">255</span></span>
<span> <span class="va">test_images</span> <span class="op">&lt;-</span> <span class="va">test_images</span> <span class="op">/</span> <span class="fl">255</span></span>
<span></span>
<span><span class="co"># Define model ----</span></span>
<span></span>
<span><span class="va">units</span> <span class="op">&lt;-</span> <span class="fl">64</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/keras_model_sequential.html" class="external-link">keras_model_sequential</a></span><span class="op">(</span>input_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">28</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_flatten.html" class="external-link">layer_flatten</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="va">units</span>, activation <span class="op">=</span> <span class="st">'relu'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">10</span>, activation <span class="op">=</span> <span class="st">'softmax'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">learning_rate</span> <span class="op">&lt;-</span> <span class="fl">0.001</span></span>
<span></span>
<span><span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://generics.r-lib.org/reference/compile.html" class="external-link">compile</a></span><span class="op">(</span></span>
<span>  optimizer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/optimizer_adam.html" class="external-link">optimizer_adam</a></span><span class="op">(</span><span class="va">learning_rate</span><span class="op">)</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">'sparse_categorical_crossentropy'</span>,</span>
<span>  metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'accuracy'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span></span>
<span></span>
<span><span class="co"># Fit model ----</span></span>
<span></span>
<span><span class="va">batch_size</span> <span class="op">&lt;-</span> <span class="fl">32</span></span>
<span><span class="va">epochs</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span></span>
<span><span class="va">.fast</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">.fast</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span></span>
<span>  <span class="va">train_images</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="op">{</span> <span class="va">.</span><span class="op">[</span><span class="va">n</span>, ,<span class="op">]</span> <span class="op">}</span></span>
<span>  <span class="va">test_images</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="op">{</span> <span class="va">.</span><span class="op">[</span><span class="va">n</span>, ,<span class="op">]</span> <span class="op">}</span></span>
<span>  <span class="va">test_labels</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="op">{</span> <span class="va">.</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">}</span></span>
<span>  <span class="va">train_labels</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="op">{</span> <span class="va">.</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">}</span></span>
<span>  <span class="va">epochs</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">history</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">train_images</span>, <span class="va">train_labels</span>,</span>
<span>      validation_split <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>      batch_size <span class="op">=</span> <span class="va">batch_size</span>,</span>
<span>      epochs <span class="op">=</span> <span class="va">epochs</span>,</span>
<span>      verbose <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">history</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate model ----</span></span>
<span></span>
<span><span class="va">score</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tensorflow/man/evaluate.html" class="external-link">evaluate</a></span><span class="op">(</span><span class="va">test_images</span>, <span class="va">test_labels</span>,</span>
<span>           verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'test_loss:'</span>, <span class="va">score</span><span class="op">$</span><span class="va">loss</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'test_accuracy:'</span>, <span class="va">score</span><span class="op">$</span><span class="va">accuracy</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save_model_tf(model, "model.keras")</span></span>
<span><span class="co"># saveRDS(history, "history.rds")</span></span></code></pre></div>
<p>To train a model with <strong>guildai</strong>, just use the
<code><a href="../reference/guild_run.html">guild_run()</a></code> function in place of the <code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code>
function to execute your R script. For example:</p>
<p>We can source this script at the R console with
<code>source("fashion-mnist.R")</code>, or run it at the Terminal with
<code>Rscript fashion-mnist.R</code>. Or we can run it using
<code><a href="../reference/guild_run.html">guild_run()</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"fashion-mnist.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; &gt; library(keras)</span></span>
<span><span class="co">#&gt; &gt; # Prepare data ----</span></span>
<span><span class="co">#&gt; &gt; fashion_mnist &lt;- dataset_fashion_mnist()</span></span>
<span><span class="co">#&gt; 2022-10-21 11:10:14.683809: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered</span></span>
<span><span class="co">#&gt; &gt; c(train_images, train_labels) %&lt;-% fashion_mnist$train</span></span>
<span><span class="co">#&gt; &gt; c(test_images, test_labels) %&lt;-% fashion_mnist$test</span></span>
<span><span class="co">#&gt; &gt; train_images &lt;- train_images / 255</span></span>
<span><span class="co">#&gt; &gt;  test_images &lt;- test_images / 255</span></span>
<span><span class="co">#&gt; &gt; # Define model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; units &lt;- 64</span></span>
<span><span class="co">#&gt; &gt; model &lt;- keras_model_sequential(input_shape = c(28, 28))</span></span>
<span><span class="co">#&gt; &gt; model %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_flatten() %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_dense(units = units, activation = 'relu') %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_dense(units = 10, activation = 'softmax')</span></span>
<span><span class="co">#&gt; &gt; learning_rate &lt;- 0.001</span></span>
<span><span class="co">#&gt; &gt; model %&gt;% compile(</span></span>
<span><span class="co">#&gt; +   optimizer = optimizer_adam(learning_rate),</span></span>
<span><span class="co">#&gt; +   loss = 'sparse_categorical_crossentropy',</span></span>
<span><span class="co">#&gt; +   metrics = c('accuracy')</span></span>
<span><span class="co">#&gt; + )</span></span>
<span><span class="co">#&gt; &gt; model</span></span>
<span><span class="co">#&gt; Model: "sequential"</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt;  Layer (type)                       Output Shape                    Param #     </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt;  flatten (Flatten)                  (None, 784)                     0           </span></span>
<span><span class="co">#&gt;  dense_1 (Dense)                    (None, 64)                      50240       </span></span>
<span><span class="co">#&gt;  dense (Dense)                      (None, 10)                      650         </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; Total params: 50,890</span></span>
<span><span class="co">#&gt; Trainable params: 50,890</span></span>
<span><span class="co">#&gt; Non-trainable params: 0</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt; &gt; # Fit model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; batch_size &lt;- 32</span></span>
<span><span class="co">#&gt; &gt; epochs &lt;- 20</span></span>
<span><span class="co">#&gt; &gt; .fast &lt;- TRUE</span></span>
<span><span class="co">#&gt; &gt; if (.fast) {</span></span>
<span><span class="co">#&gt; +   n &lt;- 1:20</span></span>
<span><span class="co">#&gt; +   train_images %&lt;&gt;% { .[n, ,] }</span></span>
<span><span class="co">#&gt; +   test_images %&lt;&gt;% { .[n, ,] }</span></span>
<span><span class="co">#&gt; +   test_labels %&lt;&gt;% { .[n] }</span></span>
<span><span class="co">#&gt; +   train_labels %&lt;&gt;% { .[n] }</span></span>
<span><span class="co">#&gt; +   epochs &lt;- 2</span></span>
<span><span class="co">#&gt; + }</span></span>
<span><span class="co">#&gt; &gt; history &lt;- model %&gt;%</span></span>
<span><span class="co">#&gt; +   fit(train_images, train_labels,</span></span>
<span><span class="co">#&gt; +       validation_split = 0.2,</span></span>
<span><span class="co">#&gt; +       batch_size = batch_size,</span></span>
<span><span class="co">#&gt; +       epochs = epochs,</span></span>
<span><span class="co">#&gt; +       verbose = 2)</span></span>
<span><span class="co">#&gt; Epoch 1/2</span></span>
<span><span class="co">#&gt; 1/1 - 1s - loss: 2.6191 - accuracy: 0.0000e+00 - val_loss: 2.5341 - val_accuracy: 0.2500 - 1s/epoch - 1s/step</span></span>
<span><span class="co">#&gt; Epoch 2/2</span></span>
<span><span class="co">#&gt; 1/1 - 0s - loss: 2.1479 - accuracy: 0.3125 - val_loss: 2.4921 - val_accuracy: 0.2500 - 43ms/epoch - 43ms/step</span></span>
<span><span class="co">#&gt; &gt; plot(history)</span></span>
<span><span class="co">#&gt; &gt; # Evaluate model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; score &lt;- model %&gt;%</span></span>
<span><span class="co">#&gt; +   evaluate(test_images, test_labels,</span></span>
<span><span class="co">#&gt; +            verbose = 0) %&gt;%</span></span>
<span><span class="co">#&gt; +   as.list()</span></span>
<span><span class="co">#&gt; &gt; cat('test_loss:', score$loss, "\n")</span></span>
<span><span class="co">#&gt; test_loss: 2.518125 </span></span>
<span><span class="co">#&gt; &gt; cat('test_accuracy:', score$accuracy, "\n")</span></span>
<span><span class="co">#&gt; test_accuracy: 0.1 </span></span>
<span><span class="co">#&gt; &gt; # save_model_tf(model, "model.keras")</span></span>
<span><span class="co">#&gt; &gt; # saveRDS(history, "history.rds")</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt;</span></span></code></pre></div>
<p>By default, the output stream of the run will be shown at the R
console. After launching a run, you can launch an application to view
your runs with <code><a href="../reference/guild_view.html">guild_view()</a></code>. From the Guild View
application, you can also launch tensorboard.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/guild_view.html">guild_view</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<!-- Include a screenshot here -->
<p>You can also retrieve a data frame with information about the run
with <code><a href="../reference/ls_runs.html">ls_runs()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ls_runs.html">ls_runs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">run</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [1 × 17] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ shortId   : chr "b2c52e5a"</span></span>
<span><span class="co">#&gt;  $ label     : chr ".fast=yes batch_size=32.0 epochs=20.0 learning_rate=0.001 units=64.0"</span></span>
<span><span class="co">#&gt;  $ flags     : tibble [1 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ .fast        : logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ batch_size   : num 32</span></span>
<span><span class="co">#&gt;   ..$ epochs       : num 20</span></span>
<span><span class="co">#&gt;   ..$ learning_rate: num 0.001</span></span>
<span><span class="co">#&gt;   ..$ units        : num 64</span></span>
<span><span class="co">#&gt;  $ scalars   :List of 1</span></span>
<span><span class="co">#&gt;   ..$ : tibble [2 × 14] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   .. ..$ run       : chr [1:2] "b2c52e5abf5448ea91a6282444162099" "b2c52e5abf5448ea91a6282444162099"</span></span>
<span><span class="co">#&gt;   .. ..$ prefix    : chr [1:2] ".guild" ".guild"</span></span>
<span><span class="co">#&gt;   .. ..$ tag       : chr [1:2] "test_accuracy" "test_loss"</span></span>
<span><span class="co">#&gt;   .. ..$ first_val : num [1:2] 0.1 2.52</span></span>
<span><span class="co">#&gt;   .. ..$ first_step: int [1:2] 0 0</span></span>
<span><span class="co">#&gt;   .. ..$ last_val  : num [1:2] 0.1 2.52</span></span>
<span><span class="co">#&gt;   .. ..$ last_step : int [1:2] 0 0</span></span>
<span><span class="co">#&gt;   .. ..$ min_val   : num [1:2] 0.1 2.52</span></span>
<span><span class="co">#&gt;   .. ..$ min_step  : int [1:2] 0 0</span></span>
<span><span class="co">#&gt;   .. ..$ max_val   : num [1:2] 0.1 2.52</span></span>
<span><span class="co">#&gt;   .. ..$ max_step  : int [1:2] 0 0</span></span>
<span><span class="co">#&gt;   .. ..$ avg_val   : num [1:2] 0.1 2.52</span></span>
<span><span class="co">#&gt;   .. ..$ total     : num [1:2] 0.1 2.52</span></span>
<span><span class="co">#&gt;   .. ..$ count     : int [1:2] 1 1</span></span>
<span><span class="co">#&gt;  $ dir       : chr "/home/tomasz/guild/guildai-r/vignettes/articles/.guild/runs/b2c52e5abf5448ea91a6282444162099"</span></span>
<span><span class="co">#&gt;  $ operation : chr "fashion-mnist.R"</span></span>
<span><span class="co">#&gt;  $ started   : POSIXct[1:1], format: "2022-10-21 11:10:12"</span></span>
<span><span class="co">#&gt;  $ stopped   : POSIXct[1:1], format: "2022-10-21 11:10:21"</span></span>
<span><span class="co">#&gt;  $ time      : chr "0:00:08"</span></span>
<span><span class="co">#&gt;  $ tags      : chr ""</span></span>
<span><span class="co">#&gt;  $ comments  :List of 1</span></span>
<span><span class="co">#&gt;   ..$ : chr(0) </span></span>
<span><span class="co">#&gt;  $ status    : chr "completed"</span></span>
<span><span class="co">#&gt;  $ exitStatus: int 0</span></span>
<span><span class="co">#&gt;  $ otherAttrs:'data.frame':  1 obs. of  0 variables</span></span>
<span><span class="co">#&gt;  $ deps      :List of 1</span></span>
<span><span class="co">#&gt;   ..$ : list()</span></span>
<span><span class="co">#&gt;  $ projectDir: chr "/home/tomasz/guild/guildai-r/vignettes/articles"</span></span>
<span><span class="co">#&gt;  $ id        : chr "b2c52e5abf5448ea91a6282444162099"</span></span></code></pre></div>
<p><code><a href="../reference/ls_runs.html">ls_runs()</a></code> returns a data.frame with information about
runs. In our sample project, we’ve launched one run, so
<code><a href="../reference/ls_runs.html">ls_runs()</a></code> returns a 1-row dataframe.</p>
<p>Importantly, all the information about the run is stored as plain
files on the filesystem.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="va">run</span><span class="op">$</span><span class="va">dir</span>, all<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">/home/tomasz/guild/guildai-r/vignettes/articles/.guild/runs/b2c52e5abf5448ea91a6282444162099</span></span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">.guild</span></span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">attrs</span></span></span>
<span><span class="co">#&gt; │   │   ├── cmd</span></span>
<span><span class="co">#&gt; │   │   ├── deps</span></span>
<span><span class="co">#&gt; │   │   ├── env</span></span>
<span><span class="co">#&gt; │   │   ├── exit_status</span></span>
<span><span class="co">#&gt; │   │   ├── flags</span></span>
<span><span class="co">#&gt; │   │   ├── host</span></span>
<span><span class="co">#&gt; │   │   ├── id</span></span>
<span><span class="co">#&gt; │   │   ├── initialized</span></span>
<span><span class="co">#&gt; │   │   ├── label</span></span>
<span><span class="co">#&gt; │   │   ├── op</span></span>
<span><span class="co">#&gt; │   │   ├── platform</span></span>
<span><span class="co">#&gt; │   │   ├── random_seed</span></span>
<span><span class="co">#&gt; │   │   ├── run_params</span></span>
<span><span class="co">#&gt; │   │   ├── sourcecode_digest</span></span>
<span><span class="co">#&gt; │   │   ├── started</span></span>
<span><span class="co">#&gt; │   │   ├── stopped</span></span>
<span><span class="co">#&gt; │   │   ├── user</span></span>
<span><span class="co">#&gt; │   │   ├── user_flags</span></span>
<span><span class="co">#&gt; │   │   └── vcs_commit</span></span>
<span><span class="co">#&gt; │   ├── events.out.tfevents.1666365020.horse.10305.0</span></span>
<span><span class="co">#&gt; │   ├── manifest</span></span>
<span><span class="co">#&gt; │   ├── opref</span></span>
<span><span class="co">#&gt; │   ├── output</span></span>
<span><span class="co">#&gt; │   ├── output.index</span></span>
<span><span class="co">#&gt; │   └── <span style="color: #0000BB; font-weight: bold;">sourcecode</span></span></span>
<span><span class="co">#&gt; │       └── <span style="color: #00BB00;">fashion-mnist.R</span></span></span>
<span><span class="co">#&gt; └── <span style="color: #0000BB; font-weight: bold;">plots</span></span></span>
<span><span class="co">#&gt;     └── <span style="color: #BB00BB; font-weight: bold;">Rplot001.png</span></span></span></code></pre></div>
<p><code><a href="../reference/guild_view.html">guild_view()</a></code> and <code><a href="../reference/ls_runs.html">ls_runs()</a></code> provide two
convenient ways to gather and present information about runs.</p>
<p>A run can also be used to generate a summary report, a paramaterized
quarto document:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/view_run_report.html">view_run_report</a></span><span class="op">(</span><span class="va">run</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="comparing-runs">Comparing Runs<a class="anchor" aria-label="anchor" href="#comparing-runs"></a>
</h2>
<p>Let’s make a couple of changes to our training script to see if we
can improve model performance. We’ll change the number of units in our
first dense layer to 128, change the <code>learning_rate</code> from
0.001 to 0.003 and run 30 rather than 20 <code>epochs</code>. After
making these changes to the source code we re-run the script using
<code>training_run()</code> as before:</p>
<pre><code><span><span class="co">#&gt; Replaced expression 'units &lt;- 64' on line 14 with 'units &lt;- 128'</span></span>
<span><span class="co">#&gt; Replaced expression 'learning_rate &lt;- 0.001' on line 23 with 'learning_rate &lt;- 0.003'</span></span>
<span><span class="co">#&gt; Replaced expression 'epochs &lt;- 20' on line 36 with 'epochs &lt;- 30'</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"fashion-mnist.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; &gt; library(keras)</span></span>
<span><span class="co">#&gt; &gt; # Prepare data ----</span></span>
<span><span class="co">#&gt; &gt; fashion_mnist &lt;- dataset_fashion_mnist()</span></span>
<span><span class="co">#&gt; 2022-10-21 11:10:24.529679: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered</span></span>
<span><span class="co">#&gt; &gt; c(train_images, train_labels) %&lt;-% fashion_mnist$train</span></span>
<span><span class="co">#&gt; &gt; c(test_images, test_labels) %&lt;-% fashion_mnist$test</span></span>
<span><span class="co">#&gt; &gt; train_images &lt;- train_images / 255</span></span>
<span><span class="co">#&gt; &gt;  test_images &lt;- test_images / 255</span></span>
<span><span class="co">#&gt; &gt; # Define model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; units &lt;- 128</span></span>
<span><span class="co">#&gt; &gt; model &lt;- keras_model_sequential(input_shape = c(28, 28))</span></span>
<span><span class="co">#&gt; &gt; model %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_flatten() %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_dense(units = units, activation = 'relu') %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_dense(units = 10, activation = 'softmax')</span></span>
<span><span class="co">#&gt; &gt; learning_rate &lt;- 0.003</span></span>
<span><span class="co">#&gt; &gt; model %&gt;% compile(</span></span>
<span><span class="co">#&gt; +   optimizer = optimizer_adam(learning_rate),</span></span>
<span><span class="co">#&gt; +   loss = 'sparse_categorical_crossentropy',</span></span>
<span><span class="co">#&gt; +   metrics = c('accuracy')</span></span>
<span><span class="co">#&gt; + )</span></span>
<span><span class="co">#&gt; &gt; model</span></span>
<span><span class="co">#&gt; Model: "sequential"</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt;  Layer (type)                       Output Shape                    Param #     </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt;  flatten (Flatten)                  (None, 784)                     0           </span></span>
<span><span class="co">#&gt;  dense_1 (Dense)                    (None, 128)                     100480      </span></span>
<span><span class="co">#&gt;  dense (Dense)                      (None, 10)                      1290        </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; Total params: 101,770</span></span>
<span><span class="co">#&gt; Trainable params: 101,770</span></span>
<span><span class="co">#&gt; Non-trainable params: 0</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt; &gt; # Fit model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; batch_size &lt;- 32</span></span>
<span><span class="co">#&gt; &gt; epochs &lt;- 30</span></span>
<span><span class="co">#&gt; &gt; .fast &lt;- TRUE</span></span>
<span><span class="co">#&gt; &gt; if (.fast) {</span></span>
<span><span class="co">#&gt; +   n &lt;- 1:20</span></span>
<span><span class="co">#&gt; +   train_images %&lt;&gt;% { .[n, ,] }</span></span>
<span><span class="co">#&gt; +   test_images %&lt;&gt;% { .[n, ,] }</span></span>
<span><span class="co">#&gt; +   test_labels %&lt;&gt;% { .[n] }</span></span>
<span><span class="co">#&gt; +   train_labels %&lt;&gt;% { .[n] }</span></span>
<span><span class="co">#&gt; +   epochs &lt;- 2</span></span>
<span><span class="co">#&gt; + }</span></span>
<span><span class="co">#&gt; &gt; history &lt;- model %&gt;%</span></span>
<span><span class="co">#&gt; +   fit(train_images, train_labels,</span></span>
<span><span class="co">#&gt; +       validation_split = 0.2,</span></span>
<span><span class="co">#&gt; +       batch_size = batch_size,</span></span>
<span><span class="co">#&gt; +       epochs = epochs,</span></span>
<span><span class="co">#&gt; +       verbose = 2)</span></span>
<span><span class="co">#&gt; Epoch 1/2</span></span>
<span><span class="co">#&gt; 1/1 - 1s - loss: 2.2194 - accuracy: 0.1250 - val_loss: 3.0044 - val_accuracy: 0.2500 - 884ms/epoch - 884ms/step</span></span>
<span><span class="co">#&gt; Epoch 2/2</span></span>
<span><span class="co">#&gt; 1/1 - 0s - loss: 1.2208 - accuracy: 0.5000 - val_loss: 3.4903 - val_accuracy: 0.2500 - 37ms/epoch - 37ms/step</span></span>
<span><span class="co">#&gt; &gt; plot(history)</span></span>
<span><span class="co">#&gt; &gt; # Evaluate model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; score &lt;- model %&gt;%</span></span>
<span><span class="co">#&gt; +   evaluate(test_images, test_labels,</span></span>
<span><span class="co">#&gt; +            verbose = 0) %&gt;%</span></span>
<span><span class="co">#&gt; +   as.list()</span></span>
<span><span class="co">#&gt; &gt; cat('test_loss:', score$loss, "\n")</span></span>
<span><span class="co">#&gt; test_loss: 3.320219 </span></span>
<span><span class="co">#&gt; &gt; cat('test_accuracy:', score$accuracy, "\n")</span></span>
<span><span class="co">#&gt; test_accuracy: 0.2 </span></span>
<span><span class="co">#&gt; &gt; # save_model_tf(model, "model.keras")</span></span>
<span><span class="co">#&gt; &gt; # saveRDS(history, "history.rds")</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt;</span></span></code></pre></div>
<p>This will also show us a report summarizing the results of the run,
but what we are really interested in is a comparison between this run
and the previous one. We can view a comparison via the
<code><a href="../reference/view_runs_diff.html">view_runs_diff()</a></code> function:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/view_runs_diff.html">view_runs_diff</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The comparison report shows the model attributes and metrics
side-by-side, as well as differences in the source code and output of
the training script.</p>
<p>Note that <code><a href="../reference/view_runs_diff.html">view_runs_diff()</a></code> will by default compare the
last two runs, however you can pass any two run ids you like to be
compared.</p>
</div>
<div class="section level2">
<h2 id="analyzing-runs">Analyzing Runs<a class="anchor" aria-label="anchor" href="#analyzing-runs"></a>
</h2>
<p>We’ve demonstrated visualizing and comparing one or two runs, however
as you accumulate more runs you’ll generally want to analyze and compare
runs many runs. You can use the <code><a href="../reference/ls_runs.html">ls_runs()</a></code> function to yield
a data frame with summary information on all of the runs you’ve
conducted.</p>
</div>
<div class="section level2">
<h2 id="flags">Flags<a class="anchor" aria-label="anchor" href="#flags"></a>
</h2>
<p>Flags are a form of run inputs, or paramaterization. The action we
just did, of modifying <code>learning_rate</code>, <code>epochs</code>
and <code>units</code> values in the script before launching the second
run, can be handled for us by <code><a href="../reference/guild_run.html">guild_run()</a></code> using the
<em>flags</em> interface.</p>
<p>By default, top-level assignments of scalar literals in an R script
are identified by guild as run flags, that can be modified per-run. You
can quickly see what flags are available in an R script by passing
<code>--help-op</code> (more on this later).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"fashion-mnist.R"</span>, <span class="st">"--help-op"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Usage: guild run [OPTIONS] fashion-mnist.R [FLAG]...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Use 'guild run --help' for a list of options.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Flags:</span></span>
<span><span class="co">#&gt;   .fast          (default is yes)</span></span>
<span><span class="co">#&gt;   batch_size     (default is 32.0)</span></span>
<span><span class="co">#&gt;   epochs         (default is 30.0)</span></span>
<span><span class="co">#&gt;   learning_rate  (default is 0.003)</span></span>
<span><span class="co">#&gt;   units          (default is 128.0)</span></span></code></pre></div>
<p>To launch a run with different flag values, we can do this:</p>
<p>Now, when we inspect the output with <code><a href="../reference/view_runs_diff.html">view_runs_diff()</a></code>,
we see that the source files associated with the run have the updated
flag values, as if we had modified them manually.</p>
<p>The flags interface is useful for hyperparamater optimization.</p>
<p>At it’s simplest, we can pass multiple values for each flag, and
guild will automatically expand the combinations to a grid search. For
example, this will launch 4 training runs, with each combination of flag
values:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"fashion-mnist.R"</span>, </span>
<span>          flags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>learning_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.003</span><span class="op">)</span>,</span>
<span>                       units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">128</span>, <span class="fl">256</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; INFO: [guild] Running trial 065cf561a3ab4949bee65dd6f6eec778: fashion-mnist.R (.fast=yes, batch_size=32.0, epochs=30.0, learning_rate=0.001, units=128.0)</span></span>
<span><span class="co">#&gt; Replaced expression 'learning_rate &lt;- 0.003' on line 23 with 'learning_rate &lt;- 0.001'</span></span>
<span><span class="co">#&gt; &gt; library(keras)</span></span>
<span><span class="co">#&gt; &gt; # Prepare data ----</span></span>
<span><span class="co">#&gt; &gt; fashion_mnist &lt;- dataset_fashion_mnist()</span></span>
<span><span class="co">#&gt; 2022-10-21 11:10:41.744141: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered</span></span>
<span><span class="co">#&gt; &gt; c(train_images, train_labels) %&lt;-% fashion_mnist$train</span></span>
<span><span class="co">#&gt; &gt; c(test_images, test_labels) %&lt;-% fashion_mnist$test</span></span>
<span><span class="co">#&gt; &gt; train_images &lt;- train_images / 255</span></span>
<span><span class="co">#&gt; &gt;  test_images &lt;- test_images / 255</span></span>
<span><span class="co">#&gt; &gt; # Define model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; units &lt;- 128</span></span>
<span><span class="co">#&gt; &gt; model &lt;- keras_model_sequential(input_shape = c(28, 28))</span></span>
<span><span class="co">#&gt; &gt; model %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_flatten() %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_dense(units = units, activation = 'relu') %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_dense(units = 10, activation = 'softmax')</span></span>
<span><span class="co">#&gt; &gt; learning_rate &lt;- 0.001</span></span>
<span><span class="co">#&gt; &gt; model %&gt;% compile(</span></span>
<span><span class="co">#&gt; +   optimizer = optimizer_adam(learning_rate),</span></span>
<span><span class="co">#&gt; +   loss = 'sparse_categorical_crossentropy',</span></span>
<span><span class="co">#&gt; +   metrics = c('accuracy')</span></span>
<span><span class="co">#&gt; + )</span></span>
<span><span class="co">#&gt; &gt; model</span></span>
<span><span class="co">#&gt; Model: "sequential"</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt;  Layer (type)                       Output Shape                    Param #     </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt;  flatten (Flatten)                  (None, 784)                     0           </span></span>
<span><span class="co">#&gt;  dense_1 (Dense)                    (None, 128)                     100480      </span></span>
<span><span class="co">#&gt;  dense (Dense)                      (None, 10)                      1290        </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; Total params: 101,770</span></span>
<span><span class="co">#&gt; Trainable params: 101,770</span></span>
<span><span class="co">#&gt; Non-trainable params: 0</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt; &gt; # Fit model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; batch_size &lt;- 32</span></span>
<span><span class="co">#&gt; &gt; epochs &lt;- 30</span></span>
<span><span class="co">#&gt; &gt; .fast &lt;- TRUE</span></span>
<span><span class="co">#&gt; &gt; if (.fast) {</span></span>
<span><span class="co">#&gt; +   n &lt;- 1:20</span></span>
<span><span class="co">#&gt; +   train_images %&lt;&gt;% { .[n, ,] }</span></span>
<span><span class="co">#&gt; +   test_images %&lt;&gt;% { .[n, ,] }</span></span>
<span><span class="co">#&gt; +   test_labels %&lt;&gt;% { .[n] }</span></span>
<span><span class="co">#&gt; +   train_labels %&lt;&gt;% { .[n] }</span></span>
<span><span class="co">#&gt; +   epochs &lt;- 2</span></span>
<span><span class="co">#&gt; + }</span></span>
<span><span class="co">#&gt; &gt; history &lt;- model %&gt;%</span></span>
<span><span class="co">#&gt; +   fit(train_images, train_labels,</span></span>
<span><span class="co">#&gt; +       validation_split = 0.2,</span></span>
<span><span class="co">#&gt; +       batch_size = batch_size,</span></span>
<span><span class="co">#&gt; +       epochs = epochs,</span></span>
<span><span class="co">#&gt; +       verbose = 2)</span></span>
<span><span class="co">#&gt; Epoch 1/2</span></span>
<span><span class="co">#&gt; 1/1 - 1s - loss: 2.2507 - accuracy: 0.0000e+00 - val_loss: 2.5298 - val_accuracy: 0.2500 - 1s/epoch - 1s/step</span></span>
<span><span class="co">#&gt; Epoch 2/2</span></span>
<span><span class="co">#&gt; 1/1 - 0s - loss: 1.6769 - accuracy: 0.4375 - val_loss: 2.8370 - val_accuracy: 0.2500 - 60ms/epoch - 60ms/step</span></span>
<span><span class="co">#&gt; &gt; plot(history)</span></span>
<span><span class="co">#&gt; &gt; # Evaluate model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; score &lt;- model %&gt;%</span></span>
<span><span class="co">#&gt; +   evaluate(test_images, test_labels,</span></span>
<span><span class="co">#&gt; +            verbose = 0) %&gt;%</span></span>
<span><span class="co">#&gt; +   as.list()</span></span>
<span><span class="co">#&gt; &gt; cat('test_loss:', score$loss, "\n")</span></span>
<span><span class="co">#&gt; test_loss: 2.980134 </span></span>
<span><span class="co">#&gt; &gt; cat('test_accuracy:', score$accuracy, "\n")</span></span>
<span><span class="co">#&gt; test_accuracy: 0.15 </span></span>
<span><span class="co">#&gt; &gt; # save_model_tf(model, "model.keras")</span></span>
<span><span class="co">#&gt; &gt; # saveRDS(history, "history.rds")</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; INFO: [guild] Running trial d0ab1c3bdd7043d5960ae2d487dfb006: fashion-mnist.R (.fast=yes, batch_size=32.0, epochs=30.0, learning_rate=0.001, units=256.0)</span></span>
<span><span class="co">#&gt; Replaced expression 'units &lt;- 128' on line 14 with 'units &lt;- 256'</span></span>
<span><span class="co">#&gt; Replaced expression 'learning_rate &lt;- 0.003' on line 23 with 'learning_rate &lt;- 0.001'</span></span>
<span><span class="co">#&gt; &gt; library(keras)</span></span>
<span><span class="co">#&gt; &gt; # Prepare data ----</span></span>
<span><span class="co">#&gt; &gt; fashion_mnist &lt;- dataset_fashion_mnist()</span></span>
<span><span class="co">#&gt; 2022-10-21 11:10:48.823593: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered</span></span>
<span><span class="co">#&gt; &gt; c(train_images, train_labels) %&lt;-% fashion_mnist$train</span></span>
<span><span class="co">#&gt; &gt; c(test_images, test_labels) %&lt;-% fashion_mnist$test</span></span>
<span><span class="co">#&gt; &gt; train_images &lt;- train_images / 255</span></span>
<span><span class="co">#&gt; &gt;  test_images &lt;- test_images / 255</span></span>
<span><span class="co">#&gt; &gt; # Define model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; units &lt;- 256</span></span>
<span><span class="co">#&gt; &gt; model &lt;- keras_model_sequential(input_shape = c(28, 28))</span></span>
<span><span class="co">#&gt; &gt; model %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_flatten() %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_dense(units = units, activation = 'relu') %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_dense(units = 10, activation = 'softmax')</span></span>
<span><span class="co">#&gt; &gt; learning_rate &lt;- 0.001</span></span>
<span><span class="co">#&gt; &gt; model %&gt;% compile(</span></span>
<span><span class="co">#&gt; +   optimizer = optimizer_adam(learning_rate),</span></span>
<span><span class="co">#&gt; +   loss = 'sparse_categorical_crossentropy',</span></span>
<span><span class="co">#&gt; +   metrics = c('accuracy')</span></span>
<span><span class="co">#&gt; + )</span></span>
<span><span class="co">#&gt; &gt; model</span></span>
<span><span class="co">#&gt; Model: "sequential"</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt;  Layer (type)                       Output Shape                    Param #     </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt;  flatten (Flatten)                  (None, 784)                     0           </span></span>
<span><span class="co">#&gt;  dense_1 (Dense)                    (None, 256)                     200960      </span></span>
<span><span class="co">#&gt;  dense (Dense)                      (None, 10)                      2570        </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; Total params: 203,530</span></span>
<span><span class="co">#&gt; Trainable params: 203,530</span></span>
<span><span class="co">#&gt; Non-trainable params: 0</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt; &gt; # Fit model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; batch_size &lt;- 32</span></span>
<span><span class="co">#&gt; &gt; epochs &lt;- 30</span></span>
<span><span class="co">#&gt; &gt; .fast &lt;- TRUE</span></span>
<span><span class="co">#&gt; &gt; if (.fast) {</span></span>
<span><span class="co">#&gt; +   n &lt;- 1:20</span></span>
<span><span class="co">#&gt; +   train_images %&lt;&gt;% { .[n, ,] }</span></span>
<span><span class="co">#&gt; +   test_images %&lt;&gt;% { .[n, ,] }</span></span>
<span><span class="co">#&gt; +   test_labels %&lt;&gt;% { .[n] }</span></span>
<span><span class="co">#&gt; +   train_labels %&lt;&gt;% { .[n] }</span></span>
<span><span class="co">#&gt; +   epochs &lt;- 2</span></span>
<span><span class="co">#&gt; + }</span></span>
<span><span class="co">#&gt; &gt; history &lt;- model %&gt;%</span></span>
<span><span class="co">#&gt; +   fit(train_images, train_labels,</span></span>
<span><span class="co">#&gt; +       validation_split = 0.2,</span></span>
<span><span class="co">#&gt; +       batch_size = batch_size,</span></span>
<span><span class="co">#&gt; +       epochs = epochs,</span></span>
<span><span class="co">#&gt; +       verbose = 2)</span></span>
<span><span class="co">#&gt; Epoch 1/2</span></span>
<span><span class="co">#&gt; 1/1 - 1s - loss: 2.2208 - accuracy: 0.1250 - val_loss: 2.6775 - val_accuracy: 0.2500 - 1s/epoch - 1s/step</span></span>
<span><span class="co">#&gt; Epoch 2/2</span></span>
<span><span class="co">#&gt; 1/1 - 0s - loss: 1.4627 - accuracy: 0.5625 - val_loss: 2.9635 - val_accuracy: 0.2500 - 39ms/epoch - 39ms/step</span></span>
<span><span class="co">#&gt; &gt; plot(history)</span></span>
<span><span class="co">#&gt; &gt; # Evaluate model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; score &lt;- model %&gt;%</span></span>
<span><span class="co">#&gt; +   evaluate(test_images, test_labels,</span></span>
<span><span class="co">#&gt; +            verbose = 0) %&gt;%</span></span>
<span><span class="co">#&gt; +   as.list()</span></span>
<span><span class="co">#&gt; &gt; cat('test_loss:', score$loss, "\n")</span></span>
<span><span class="co">#&gt; test_loss: 2.818139 </span></span>
<span><span class="co">#&gt; &gt; cat('test_accuracy:', score$accuracy, "\n")</span></span>
<span><span class="co">#&gt; test_accuracy: 0.25 </span></span>
<span><span class="co">#&gt; &gt; # save_model_tf(model, "model.keras")</span></span>
<span><span class="co">#&gt; &gt; # saveRDS(history, "history.rds")</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; INFO: [guild] Running trial 78e198214a334eae9ad70d9746c0405e: fashion-mnist.R (.fast=yes, batch_size=32.0, epochs=30.0, learning_rate=0.003, units=128.0)</span></span>
<span><span class="co">#&gt; &gt; library(keras)</span></span>
<span><span class="co">#&gt; &gt; # Prepare data ----</span></span>
<span><span class="co">#&gt; &gt; fashion_mnist &lt;- dataset_fashion_mnist()</span></span>
<span><span class="co">#&gt; 2022-10-21 11:10:57.182763: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered</span></span>
<span><span class="co">#&gt; &gt; c(train_images, train_labels) %&lt;-% fashion_mnist$train</span></span>
<span><span class="co">#&gt; &gt; c(test_images, test_labels) %&lt;-% fashion_mnist$test</span></span>
<span><span class="co">#&gt; &gt; train_images &lt;- train_images / 255</span></span>
<span><span class="co">#&gt; &gt;  test_images &lt;- test_images / 255</span></span>
<span><span class="co">#&gt; &gt; # Define model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; units &lt;- 128</span></span>
<span><span class="co">#&gt; &gt; model &lt;- keras_model_sequential(input_shape = c(28, 28))</span></span>
<span><span class="co">#&gt; &gt; model %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_flatten() %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_dense(units = units, activation = 'relu') %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_dense(units = 10, activation = 'softmax')</span></span>
<span><span class="co">#&gt; &gt; learning_rate &lt;- 0.003</span></span>
<span><span class="co">#&gt; &gt; model %&gt;% compile(</span></span>
<span><span class="co">#&gt; +   optimizer = optimizer_adam(learning_rate),</span></span>
<span><span class="co">#&gt; +   loss = 'sparse_categorical_crossentropy',</span></span>
<span><span class="co">#&gt; +   metrics = c('accuracy')</span></span>
<span><span class="co">#&gt; + )</span></span>
<span><span class="co">#&gt; &gt; model</span></span>
<span><span class="co">#&gt; Model: "sequential"</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt;  Layer (type)                       Output Shape                    Param #     </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt;  flatten (Flatten)                  (None, 784)                     0           </span></span>
<span><span class="co">#&gt;  dense_1 (Dense)                    (None, 128)                     100480      </span></span>
<span><span class="co">#&gt;  dense (Dense)                      (None, 10)                      1290        </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; Total params: 101,770</span></span>
<span><span class="co">#&gt; Trainable params: 101,770</span></span>
<span><span class="co">#&gt; Non-trainable params: 0</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt; &gt; # Fit model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; batch_size &lt;- 32</span></span>
<span><span class="co">#&gt; &gt; epochs &lt;- 30</span></span>
<span><span class="co">#&gt; &gt; .fast &lt;- TRUE</span></span>
<span><span class="co">#&gt; &gt; if (.fast) {</span></span>
<span><span class="co">#&gt; +   n &lt;- 1:20</span></span>
<span><span class="co">#&gt; +   train_images %&lt;&gt;% { .[n, ,] }</span></span>
<span><span class="co">#&gt; +   test_images %&lt;&gt;% { .[n, ,] }</span></span>
<span><span class="co">#&gt; +   test_labels %&lt;&gt;% { .[n] }</span></span>
<span><span class="co">#&gt; +   train_labels %&lt;&gt;% { .[n] }</span></span>
<span><span class="co">#&gt; +   epochs &lt;- 2</span></span>
<span><span class="co">#&gt; + }</span></span>
<span><span class="co">#&gt; &gt; history &lt;- model %&gt;%</span></span>
<span><span class="co">#&gt; +   fit(train_images, train_labels,</span></span>
<span><span class="co">#&gt; +       validation_split = 0.2,</span></span>
<span><span class="co">#&gt; +       batch_size = batch_size,</span></span>
<span><span class="co">#&gt; +       epochs = epochs,</span></span>
<span><span class="co">#&gt; +       verbose = 2)</span></span>
<span><span class="co">#&gt; Epoch 1/2</span></span>
<span><span class="co">#&gt; 1/1 - 1s - loss: 2.2651 - accuracy: 0.1875 - val_loss: 3.2124 - val_accuracy: 0.2500 - 891ms/epoch - 891ms/step</span></span>
<span><span class="co">#&gt; Epoch 2/2</span></span>
<span><span class="co">#&gt; 1/1 - 0s - loss: 1.3404 - accuracy: 0.5625 - val_loss: 3.8982 - val_accuracy: 0.2500 - 42ms/epoch - 42ms/step</span></span>
<span><span class="co">#&gt; &gt; plot(history)</span></span>
<span><span class="co">#&gt; &gt; # Evaluate model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; score &lt;- model %&gt;%</span></span>
<span><span class="co">#&gt; +   evaluate(test_images, test_labels,</span></span>
<span><span class="co">#&gt; +            verbose = 0) %&gt;%</span></span>
<span><span class="co">#&gt; +   as.list()</span></span>
<span><span class="co">#&gt; &gt; cat('test_loss:', score$loss, "\n")</span></span>
<span><span class="co">#&gt; test_loss: 3.370405 </span></span>
<span><span class="co">#&gt; &gt; cat('test_accuracy:', score$accuracy, "\n")</span></span>
<span><span class="co">#&gt; test_accuracy: 0.2 </span></span>
<span><span class="co">#&gt; &gt; # save_model_tf(model, "model.keras")</span></span>
<span><span class="co">#&gt; &gt; # saveRDS(history, "history.rds")</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; INFO: [guild] Running trial 9fb445b5377648cea7fc1896deb30c9f: fashion-mnist.R (.fast=yes, batch_size=32.0, epochs=30.0, learning_rate=0.003, units=256.0)</span></span>
<span><span class="co">#&gt; Replaced expression 'units &lt;- 128' on line 14 with 'units &lt;- 256'</span></span>
<span><span class="co">#&gt; &gt; library(keras)</span></span>
<span><span class="co">#&gt; &gt; # Prepare data ----</span></span>
<span><span class="co">#&gt; &gt; fashion_mnist &lt;- dataset_fashion_mnist()</span></span>
<span><span class="co">#&gt; 2022-10-21 11:11:03.943330: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered</span></span>
<span><span class="co">#&gt; &gt; c(train_images, train_labels) %&lt;-% fashion_mnist$train</span></span>
<span><span class="co">#&gt; &gt; c(test_images, test_labels) %&lt;-% fashion_mnist$test</span></span>
<span><span class="co">#&gt; &gt; train_images &lt;- train_images / 255</span></span>
<span><span class="co">#&gt; &gt;  test_images &lt;- test_images / 255</span></span>
<span><span class="co">#&gt; &gt; # Define model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; units &lt;- 256</span></span>
<span><span class="co">#&gt; &gt; model &lt;- keras_model_sequential(input_shape = c(28, 28))</span></span>
<span><span class="co">#&gt; &gt; model %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_flatten() %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_dense(units = units, activation = 'relu') %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_dense(units = 10, activation = 'softmax')</span></span>
<span><span class="co">#&gt; &gt; learning_rate &lt;- 0.003</span></span>
<span><span class="co">#&gt; &gt; model %&gt;% compile(</span></span>
<span><span class="co">#&gt; +   optimizer = optimizer_adam(learning_rate),</span></span>
<span><span class="co">#&gt; +   loss = 'sparse_categorical_crossentropy',</span></span>
<span><span class="co">#&gt; +   metrics = c('accuracy')</span></span>
<span><span class="co">#&gt; + )</span></span>
<span><span class="co">#&gt; &gt; model</span></span>
<span><span class="co">#&gt; Model: "sequential"</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt;  Layer (type)                       Output Shape                    Param #     </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt;  flatten (Flatten)                  (None, 784)                     0           </span></span>
<span><span class="co">#&gt;  dense_1 (Dense)                    (None, 256)                     200960      </span></span>
<span><span class="co">#&gt;  dense (Dense)                      (None, 10)                      2570        </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; Total params: 203,530</span></span>
<span><span class="co">#&gt; Trainable params: 203,530</span></span>
<span><span class="co">#&gt; Non-trainable params: 0</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt; &gt; # Fit model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; batch_size &lt;- 32</span></span>
<span><span class="co">#&gt; &gt; epochs &lt;- 30</span></span>
<span><span class="co">#&gt; &gt; .fast &lt;- TRUE</span></span>
<span><span class="co">#&gt; &gt; if (.fast) {</span></span>
<span><span class="co">#&gt; +   n &lt;- 1:20</span></span>
<span><span class="co">#&gt; +   train_images %&lt;&gt;% { .[n, ,] }</span></span>
<span><span class="co">#&gt; +   test_images %&lt;&gt;% { .[n, ,] }</span></span>
<span><span class="co">#&gt; +   test_labels %&lt;&gt;% { .[n] }</span></span>
<span><span class="co">#&gt; +   train_labels %&lt;&gt;% { .[n] }</span></span>
<span><span class="co">#&gt; +   epochs &lt;- 2</span></span>
<span><span class="co">#&gt; + }</span></span>
<span><span class="co">#&gt; &gt; history &lt;- model %&gt;%</span></span>
<span><span class="co">#&gt; +   fit(train_images, train_labels,</span></span>
<span><span class="co">#&gt; +       validation_split = 0.2,</span></span>
<span><span class="co">#&gt; +       batch_size = batch_size,</span></span>
<span><span class="co">#&gt; +       epochs = epochs,</span></span>
<span><span class="co">#&gt; +       verbose = 2)</span></span>
<span><span class="co">#&gt; Epoch 1/2</span></span>
<span><span class="co">#&gt; 1/1 - 1s - loss: 2.2203 - accuracy: 0.1875 - val_loss: 3.4661 - val_accuracy: 0.2500 - 1s/epoch - 1s/step</span></span>
<span><span class="co">#&gt; Epoch 2/2</span></span>
<span><span class="co">#&gt; 1/1 - 0s - loss: 0.9872 - accuracy: 0.6875 - val_loss: 4.8555 - val_accuracy: 0.2500 - 36ms/epoch - 36ms/step</span></span>
<span><span class="co">#&gt; &gt; plot(history)</span></span>
<span><span class="co">#&gt; &gt; # Evaluate model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; score &lt;- model %&gt;%</span></span>
<span><span class="co">#&gt; +   evaluate(test_images, test_labels,</span></span>
<span><span class="co">#&gt; +            verbose = 0) %&gt;%</span></span>
<span><span class="co">#&gt; +   as.list()</span></span>
<span><span class="co">#&gt; &gt; cat('test_loss:', score$loss, "\n")</span></span>
<span><span class="co">#&gt; test_loss: 4.082088 </span></span>
<span><span class="co">#&gt; &gt; cat('test_accuracy:', score$accuracy, "\n")</span></span>
<span><span class="co">#&gt; test_accuracy: 0.25 </span></span>
<span><span class="co">#&gt; &gt; # save_model_tf(model, "model.keras")</span></span>
<span><span class="co">#&gt; &gt; # saveRDS(history, "history.rds")</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt;</span></span></code></pre></div>
<p>For more precision, we can pass a dataframe of flags values, with
each row corresponding to a run.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flags_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>learning_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.003</span><span class="op">)</span>,</span>
<span>                        units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">128</span>, <span class="fl">256</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">flags_df</span></span>
<span><span class="co">#&gt;   learning_rate units</span></span>
<span><span class="co">#&gt; 1         0.001   128</span></span>
<span><span class="co">#&gt; 2         0.003   128</span></span>
<span><span class="co">#&gt; 3         0.001   256</span></span>
<span><span class="co">#&gt; 4         0.003   256</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"fashion-mnist.R"</span>, flags <span class="op">=</span> <span class="va">flags_df</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can optionally supply additional metadata about
individual flags by placing hashpipe yaml annotations above the flag
expression. For example:</p>
<pre><code><span><span class="co">#| description: size of first layer.</span></span>
<span><span class="co">#| min: 16</span></span>
<span><span class="co">#| max: 256</span></span>
<span><span class="va">units</span> <span class="op">&lt;-</span> <span class="fl">32</span></span>
<span></span>
<span><span class="co">#| description: Activation function to use.</span></span>
<span><span class="co">#| choices: [relu, sigmoid, tanh]</span></span>
<span><span class="va">activation</span> <span class="op">&lt;-</span> <span class="st">"relu"</span></span></code></pre>
<p>Now, the <code>description</code>s and constraints will appear in
<code>--help-op</code> and related locations.</p>
<p>As a project grows, it’s helpful to be able to move flag definitions
out of the main file. To do so, you can include a
<code>flags-dest</code> in the frontmatter of the R script, specifying
the file path (relative to the project directory) of the file where
guild should place the flag values.</p>
<pre><code><span><span class="co">#| flags-dest: ./flags.R</span></span>
<span></span>
<span><span class="va">FLAGS</span> <span class="op">&lt;-</span> <span class="fu">envir</span><span class="fu">::</span><span class="fu"><a href="https://t-kalinowski.github.io/envir/reference/include.html" class="external-link">include</a></span><span class="op">(</span><span class="st">"flags.R"</span>, <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>YAML files are also supported as a flags destination:</p>
<pre><code><span><span class="co">#| flags-dest: ./flags.yml</span></span>
<span></span>
<span><span class="va">FLAGS</span> <span class="op">&lt;-</span> <span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html" class="external-link">read_yaml</a></span><span class="op">(</span><span class="st">"flags.yml"</span><span class="op">)</span></span></code></pre>
<p>The flags and flag values associated with individual runs are
returned by <code><a href="../reference/ls_runs.html">ls_runs()</a></code>.</p>
<p>Guild runs <em>operations</em>. In this simple instance, the full R
script is the operation. To get information about a specified operation,
you can add “–help-op” to the arguments.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"fashion-mnist.R"</span>, <span class="st">"--help-op"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Usage: guild run [OPTIONS] fashion-mnist.R [FLAG]...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Use 'guild run --help' for a list of options.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Flags:</span></span>
<span><span class="co">#&gt;   .fast          (default is yes)</span></span>
<span><span class="co">#&gt;   batch_size     (default is 32.0)</span></span>
<span><span class="co">#&gt;   epochs         (default is 30.0)</span></span>
<span><span class="co">#&gt;   learning_rate  (default is 0.003)</span></span>
<span><span class="co">#&gt;   units          (default is 128.0)</span></span></code></pre></div>
<p>Note that guild automatically recognized some Flags for the
operation. Flags allow for easily allows for running machine learning
experiments with guild. By default, any symbols defined at the top level
of an R scripted with scalar literal constants are identified as flags
that guild can adjust when launching a run. For example, we can ask
guild to run “fashion-mnist-1.R” with a larger batch size:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"fashion-mnist.R"</span>, flags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>batch_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in flags$.fast &lt;- TRUE: Coercing LHS to a list</span></span>
<span><span class="co">#&gt; Replaced expression 'batch_size &lt;- 32' on line 35 with 'batch_size &lt;- 16'</span></span>
<span><span class="co">#&gt; &gt; library(keras)</span></span>
<span><span class="co">#&gt; &gt; # Prepare data ----</span></span>
<span><span class="co">#&gt; &gt; fashion_mnist &lt;- dataset_fashion_mnist()</span></span>
<span><span class="co">#&gt; 2022-10-21 11:11:13.647976: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered</span></span>
<span><span class="co">#&gt; &gt; c(train_images, train_labels) %&lt;-% fashion_mnist$train</span></span>
<span><span class="co">#&gt; &gt; c(test_images, test_labels) %&lt;-% fashion_mnist$test</span></span>
<span><span class="co">#&gt; &gt; train_images &lt;- train_images / 255</span></span>
<span><span class="co">#&gt; &gt;  test_images &lt;- test_images / 255</span></span>
<span><span class="co">#&gt; &gt; # Define model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; units &lt;- 128</span></span>
<span><span class="co">#&gt; &gt; model &lt;- keras_model_sequential(input_shape = c(28, 28))</span></span>
<span><span class="co">#&gt; &gt; model %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_flatten() %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_dense(units = units, activation = 'relu') %&gt;%</span></span>
<span><span class="co">#&gt; +   layer_dense(units = 10, activation = 'softmax')</span></span>
<span><span class="co">#&gt; &gt; learning_rate &lt;- 0.003</span></span>
<span><span class="co">#&gt; &gt; model %&gt;% compile(</span></span>
<span><span class="co">#&gt; +   optimizer = optimizer_adam(learning_rate),</span></span>
<span><span class="co">#&gt; +   loss = 'sparse_categorical_crossentropy',</span></span>
<span><span class="co">#&gt; +   metrics = c('accuracy')</span></span>
<span><span class="co">#&gt; + )</span></span>
<span><span class="co">#&gt; &gt; model</span></span>
<span><span class="co">#&gt; Model: "sequential"</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt;  Layer (type)                       Output Shape                    Param #     </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt;  flatten (Flatten)                  (None, 784)                     0           </span></span>
<span><span class="co">#&gt;  dense_1 (Dense)                    (None, 128)                     100480      </span></span>
<span><span class="co">#&gt;  dense (Dense)                      (None, 10)                      1290        </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; Total params: 101,770</span></span>
<span><span class="co">#&gt; Trainable params: 101,770</span></span>
<span><span class="co">#&gt; Non-trainable params: 0</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt; &gt; # Fit model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; batch_size &lt;- 16</span></span>
<span><span class="co">#&gt; &gt; epochs &lt;- 30</span></span>
<span><span class="co">#&gt; &gt; .fast &lt;- TRUE</span></span>
<span><span class="co">#&gt; &gt; if (.fast) {</span></span>
<span><span class="co">#&gt; +   n &lt;- 1:20</span></span>
<span><span class="co">#&gt; +   train_images %&lt;&gt;% { .[n, ,] }</span></span>
<span><span class="co">#&gt; +   test_images %&lt;&gt;% { .[n, ,] }</span></span>
<span><span class="co">#&gt; +   test_labels %&lt;&gt;% { .[n] }</span></span>
<span><span class="co">#&gt; +   train_labels %&lt;&gt;% { .[n] }</span></span>
<span><span class="co">#&gt; +   epochs &lt;- 2</span></span>
<span><span class="co">#&gt; + }</span></span>
<span><span class="co">#&gt; &gt; history &lt;- model %&gt;%</span></span>
<span><span class="co">#&gt; +   fit(train_images, train_labels,</span></span>
<span><span class="co">#&gt; +       validation_split = 0.2,</span></span>
<span><span class="co">#&gt; +       batch_size = batch_size,</span></span>
<span><span class="co">#&gt; +       epochs = epochs,</span></span>
<span><span class="co">#&gt; +       verbose = 2)</span></span>
<span><span class="co">#&gt; Epoch 1/2</span></span>
<span><span class="co">#&gt; 1/1 - 1s - loss: 2.2026 - accuracy: 0.1250 - val_loss: 3.0088 - val_accuracy: 0.2500 - 879ms/epoch - 879ms/step</span></span>
<span><span class="co">#&gt; Epoch 2/2</span></span>
<span><span class="co">#&gt; 1/1 - 0s - loss: 1.1780 - accuracy: 0.7500 - val_loss: 3.7330 - val_accuracy: 0.2500 - 35ms/epoch - 35ms/step</span></span>
<span><span class="co">#&gt; &gt; plot(history)</span></span>
<span><span class="co">#&gt; &gt; # Evaluate model ----</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt; score &lt;- model %&gt;%</span></span>
<span><span class="co">#&gt; +   evaluate(test_images, test_labels,</span></span>
<span><span class="co">#&gt; +            verbose = 0) %&gt;%</span></span>
<span><span class="co">#&gt; +   as.list()</span></span>
<span><span class="co">#&gt; &gt; cat('test_loss:', score$loss, "\n")</span></span>
<span><span class="co">#&gt; test_loss: 3.290912 </span></span>
<span><span class="co">#&gt; &gt; cat('test_accuracy:', score$accuracy, "\n")</span></span>
<span><span class="co">#&gt; test_accuracy: 0.25 </span></span>
<span><span class="co">#&gt; &gt; # save_model_tf(model, "model.keras")</span></span>
<span><span class="co">#&gt; &gt; # saveRDS(history, "history.rds")</span></span>
<span><span class="co">#&gt; &gt; </span></span>
<span><span class="co">#&gt; &gt;</span></span></code></pre></div>
<p>Now, <code><a href="../reference/ls_runs.html">ls_runs()</a></code> returns a two-row data frame. We can
inspect <code>flags</code>, to see the change:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">runs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ls_runs.html">ls_runs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">runs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">shortId</span>, <span class="va">flags</span><span class="op">)</span> <span class="co">#%&gt;% tidyr::unnest(flags, names_sep = "_")</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span></span>
<span><span class="co">#&gt;   shortId  flags$.fast $batch_size $epochs $learning_rate $units</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> c4722120 TRUE                 16      30          0.003    128</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 9fb445b5 TRUE                 32      30          0.003    256</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 78e19821 TRUE                 32      30          0.003    128</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> d0ab1c3b TRUE                 32      30          0.001    256</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 065cf561 TRUE                 32      30          0.001    128</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 8d0634a7 TRUE                 32      30          0.001    256</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> aaad2915 TRUE                 32      30          0.003    128</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> b2c52e5a TRUE                 32      20          0.001     64</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="scalars">Scalars<a class="anchor" aria-label="anchor" href="#scalars"></a>
</h2>
<p>The counterpart to run <code>flags</code> are run
<code>scalars</code>. Where as <code>flags</code> are a type of run
input, scalars are run outputs identified by guild as meaningful to
track.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">runs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">shortId</span>, <span class="va">scalars</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span></span>
<span><span class="co">#&gt;   shortId  scalars          </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> c4722120 <span style="color: #949494;">&lt;tibble [2 × 14]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 9fb445b5 <span style="color: #949494;">&lt;tibble [2 × 14]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 78e19821 <span style="color: #949494;">&lt;tibble [2 × 14]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> d0ab1c3b <span style="color: #949494;">&lt;tibble [2 × 14]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 065cf561 <span style="color: #949494;">&lt;tibble [2 × 14]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 8d0634a7 <span style="color: #949494;">&lt;tibble [2 × 14]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> aaad2915 <span style="color: #949494;">&lt;tibble [2 × 14]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> b2c52e5a <span style="color: #949494;">&lt;tibble [2 × 14]&gt;</span></span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">runs</span><span class="op">$</span><span class="va">scalars</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 2</span></span>
<span><span class="co">#&gt; Columns: 14</span></span>
<span><span class="co">#&gt; $ run        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "c4722120033f4c30a12e53e261dbbeeb", "c4722120033f4c30a12e53…</span></span>
<span><span class="co">#&gt; $ prefix     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> ".guild", ".guild"</span></span>
<span><span class="co">#&gt; $ tag        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "test_accuracy", "test_loss"</span></span>
<span><span class="co">#&gt; $ first_val  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.250000, 3.290912</span></span>
<span><span class="co">#&gt; $ first_step <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0</span></span>
<span><span class="co">#&gt; $ last_val   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.250000, 3.290912</span></span>
<span><span class="co">#&gt; $ last_step  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0</span></span>
<span><span class="co">#&gt; $ min_val    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.250000, 3.290912</span></span>
<span><span class="co">#&gt; $ min_step   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0</span></span>
<span><span class="co">#&gt; $ max_val    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.250000, 3.290912</span></span>
<span><span class="co">#&gt; $ max_step   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0</span></span>
<span><span class="co">#&gt; $ avg_val    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.250000, 3.290912</span></span>
<span><span class="co">#&gt; $ total      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.250000, 3.290912</span></span>
<span><span class="co">#&gt; $ count      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1</span></span></code></pre></div>
<p>Here we see that guild has automatically identified
<code>test_accuracy</code> and <code>test_loss</code> as run scalar
outputs. By default, any lines printed to standard output by the run
with the form <code>"key: value"</code> are recorded by guild as
<code>scalars</code>. If the same scalar <code>key</code> is output
multiple times during a run (e.g, loss during a training loop), then be
sure to also print a <code>step</code> scalar, to enable guild to track
history (and enable visualization of the run with tensorboard).</p>
<p>Alternatively, if your run process produces tensorboard logs directly
(e.g., <code><a href="https://rdrr.io/pkg/keras/man/callback_tensorboard.html" class="external-link">keras::callback_tensorboard()</a></code>), then those logs are
also identified as run scalars.</p>
<p><code><a href="../reference/ls_runs.html">ls_runs()</a></code> by default only returns a summary of run
scalars, but the full scalar history can also be accessed from R
directly:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ls_runs.html">ls_runs</a></span><span class="op">(</span>scalars <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 16 × 5</span></span></span>
<span><span class="co">#&gt;    run                              path   tag           value  step</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> c4722120033f4c30a12e53e261dbbeeb .guild test_loss     3.29      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> c4722120033f4c30a12e53e261dbbeeb .guild test_accuracy 0.25      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 9fb445b5377648cea7fc1896deb30c9f .guild test_loss     4.08      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 9fb445b5377648cea7fc1896deb30c9f .guild test_accuracy 0.25      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 78e198214a334eae9ad70d9746c0405e .guild test_loss     3.37      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 78e198214a334eae9ad70d9746c0405e .guild test_accuracy 0.200     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> d0ab1c3bdd7043d5960ae2d487dfb006 .guild test_loss     2.82      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> d0ab1c3bdd7043d5960ae2d487dfb006 .guild test_accuracy 0.25      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 065cf561a3ab4949bee65dd6f6eec778 .guild test_loss     2.98      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 065cf561a3ab4949bee65dd6f6eec778 .guild test_accuracy 0.150     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 8d0634a722fd41e58456d18147eb2c6b .guild test_loss     2.62      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 8d0634a722fd41e58456d18147eb2c6b .guild test_accuracy 0.200     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> aaad29158729450b82b0576c0ca38458 .guild test_loss     3.32      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> aaad29158729450b82b0576c0ca38458 .guild test_accuracy 0.200     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> b2c52e5abf5448ea91a6282444162099 .guild test_loss     2.52      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> b2c52e5abf5448ea91a6282444162099 .guild test_accuracy 0.100     0</span></span></code></pre></div>
<div class="section level3">
<h3 id="hyperparamater-tuning">Hyperparamater Tuning<a class="anchor" aria-label="anchor" href="#hyperparamater-tuning"></a>
</h3>
<p>We can investigate what impact flag values had on
<code>test_accuracy</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">runs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ls_runs.html">ls_runs</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">runs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">flags</span>, <span class="va">scalars</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>scalars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>    <span class="va">scalars</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">sc_df</span><span class="op">)</span> <span class="va">sc_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">select</span><span class="op">(</span><span class="va">tag</span>, <span class="va">last_val</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">tag</span>,</span>
<span>                         values_from <span class="op">=</span> <span class="va">last_val</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">flags</span>, <span class="va">scalars</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">units</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 7</span></span></span>
<span><span class="co">#&gt;   .fast batch_size epochs learning_rate units test_accuracy test_loss</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> TRUE          32     20         0.001    64         0.100      2.52</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> TRUE          16     30         0.003   128         0.25       3.29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> TRUE          32     30         0.003   128         0.200      3.37</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> TRUE          32     30         0.001   128         0.150      2.98</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> TRUE          32     30         0.003   128         0.200      3.32</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> TRUE          32     30         0.003   256         0.25       4.08</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> TRUE          32     30         0.001   256         0.25       2.82</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> TRUE          32     30         0.001   256         0.200      2.62</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">units</span>, y <span class="op">=</span> <span class="va">test_accuracy</span>, </span>
<span>               color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">learning_rate</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; `geom_smooth()` using method = 'loess' and formula 'y ~ x'</span></span>
<span><span class="co">#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =</span></span>
<span><span class="co">#&gt; parametric, : span too small. fewer data values than degrees of freedom.</span></span>
<span><span class="co">#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =</span></span>
<span><span class="co">#&gt; parametric, : pseudoinverse used at 63.04</span></span>
<span><span class="co">#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =</span></span>
<span><span class="co">#&gt; parametric, : neighborhood radius 192.96</span></span>
<span><span class="co">#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =</span></span>
<span><span class="co">#&gt; parametric, : reciprocal condition number 0</span></span>
<span><span class="co">#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =</span></span>
<span><span class="co">#&gt; parametric, : There are other near singularities as well. 16631</span></span>
<span><span class="co">#&gt; Warning in predLoess(object$y, object$x, newx = if</span></span>
<span><span class="co">#&gt; (is.null(newdata)) object$x else if (is.data.frame(newdata))</span></span>
<span><span class="co">#&gt; as.matrix(model.frame(delete.response(terms(object)), : span too small. fewer</span></span>
<span><span class="co">#&gt; data values than degrees of freedom.</span></span>
<span><span class="co">#&gt; Warning in predLoess(object$y, object$x, newx = if</span></span>
<span><span class="co">#&gt; (is.null(newdata)) object$x else if (is.data.frame(newdata))</span></span>
<span><span class="co">#&gt; as.matrix(model.frame(delete.response(terms(object)), : pseudoinverse used at</span></span>
<span><span class="co">#&gt; 63.04</span></span>
<span><span class="co">#&gt; Warning in predLoess(object$y, object$x, newx = if</span></span>
<span><span class="co">#&gt; (is.null(newdata)) object$x else if (is.data.frame(newdata))</span></span>
<span><span class="co">#&gt; as.matrix(model.frame(delete.response(terms(object)), : neighborhood radius</span></span>
<span><span class="co">#&gt; 192.96</span></span>
<span><span class="co">#&gt; Warning in predLoess(object$y, object$x, newx = if</span></span>
<span><span class="co">#&gt; (is.null(newdata)) object$x else if (is.data.frame(newdata))</span></span>
<span><span class="co">#&gt; as.matrix(model.frame(delete.response(terms(object)), : reciprocal condition</span></span>
<span><span class="co">#&gt; number 0</span></span>
<span><span class="co">#&gt; Warning in predLoess(object$y, object$x, newx = if</span></span>
<span><span class="co">#&gt; (is.null(newdata)) object$x else if (is.data.frame(newdata))</span></span>
<span><span class="co">#&gt; as.matrix(model.frame(delete.response(terms(object)), : There are other near</span></span>
<span><span class="co">#&gt; singularities as well. 16631</span></span>
<span><span class="co">#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =</span></span>
<span><span class="co">#&gt; parametric, : span too small. fewer data values than degrees of freedom.</span></span>
<span><span class="co">#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =</span></span>
<span><span class="co">#&gt; parametric, : at 127.36</span></span>
<span><span class="co">#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =</span></span>
<span><span class="co">#&gt; parametric, : radius 0.4096</span></span>
<span><span class="co">#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =</span></span>
<span><span class="co">#&gt; parametric, : all data on boundary of neighborhood. make span bigger</span></span>
<span><span class="co">#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =</span></span>
<span><span class="co">#&gt; parametric, : pseudoinverse used at 127.36</span></span>
<span><span class="co">#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =</span></span>
<span><span class="co">#&gt; parametric, : neighborhood radius 0.64</span></span>
<span><span class="co">#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =</span></span>
<span><span class="co">#&gt; parametric, : reciprocal condition number 1</span></span>
<span><span class="co">#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =</span></span>
<span><span class="co">#&gt; parametric, : There are other near singularities as well. 16548</span></span>
<span><span class="co">#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =</span></span>
<span><span class="co">#&gt; parametric, : zero-width neighborhood. make span bigger</span></span>
<span><span class="co">#&gt; Warning: Computation failed in `stat_smooth()`:</span></span>
<span><span class="co">#&gt; NA/NaN/Inf in foreign function call (arg 5)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># df %&gt;%</span></span>
<span><span class="co">#   # arrange(batch_size) %&gt;%</span></span>
<span><span class="co">#   plot(test_accuracy ~ units, data = ., type = 'p')</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit_exit.html" class="external-link">knit_exit</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tomasz Kalinowski.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
